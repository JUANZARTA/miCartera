"use strict";(self.webpackChunkmiCartera=self.webpackChunkmiCartera||[]).push([[220],{4220:(w,v,a)=>{a.r(v),a.d(v,{default:()=>C});var t=a(4438),c=a(177),p=a(9417),h=a(7673),b=a(6354),g=a(9437),f=a(1626);let _=(()=>{class o{constructor(e){this.http=e,this.FIREBASE_BASE_URL="https://micartera-acd5b-default-rtdb.firebaseio.com"}getSavings(e,i,n){return this.http.get(`${this.FIREBASE_BASE_URL}/${e}/${i}/${n}/ahorros.json`).pipe((0,b.T)(s=>s||{}),(0,g.W)(s=>(console.error("[GET] Error al obtener ahorros:",s),(0,h.of)({}))))}addSaving(e,i,n,r){return this.http.post(`${this.FIREBASE_BASE_URL}/${e}/${i}/${n}/ahorros.json`,r).pipe((0,g.W)(d=>(console.error("[POST] Error al agregar ahorro:",d),(0,h.of)(null))))}updateSaving(e,i,n,r,s){return this.http.put(`${this.FIREBASE_BASE_URL}/${e}/${i}/${n}/ahorros/${r}.json`,s).pipe((0,g.W)(V=>(console.error("[PUT] Error al actualizar ahorro:",V),(0,h.of)(null))))}deleteSaving(e,i,n,r){return this.http.delete(`${this.FIREBASE_BASE_URL}/${e}/${i}/${n}/ahorros/${r}.json`).pipe((0,g.W)(d=>(console.error("[DELETE] Error al eliminar ahorro:",d),(0,h.of)(null))))}static{this.\u0275fac=function(i){return new(i||o)(t.KVO(f.Qq))}}static{this.\u0275prov=t.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();class u{constructor(l,e){this.tipo=l,this.valor=e}}var S=a(3062),x=a(4796),j=a(402),m=a(6672);const F=(o,l,e)=>({"bg-red-600":o,"bg-blue-600":l,"bg-green-600":e});function E(o,l){if(1&o){const e=t.RV6();t.j41(0,"tr",21)(1,"td",22),t.EFF(2),t.k0s(),t.j41(3,"td",23),t.EFF(4),t.k0s(),t.j41(5,"td",24)(6,"button",25),t.bIt("click",function(){const n=t.eBV(e).$implicit,r=t.XpG();return t.Njj(r.openAddModal(n.id))}),t.j41(7,"span",26),t.EFF(8,"add"),t.k0s()(),t.j41(9,"button",27),t.bIt("click",function(){const n=t.eBV(e).$implicit,r=t.XpG();return t.Njj(r.openEditModal(n.id))}),t.j41(10,"mat-icon"),t.EFF(11,"edit"),t.k0s()(),t.j41(12,"button",28),t.bIt("click",function(){const n=t.eBV(e).$implicit,r=t.XpG();return t.Njj(r.openDeleteModal(n.id))}),t.j41(13,"mat-icon"),t.EFF(14,"delete"),t.k0s()()()()}if(2&o){const e=l.$implicit,i=t.XpG();t.R7$(2),t.JRh(e.tipo),t.R7$(2),t.SpI(" $",i.formatCurrency(e.valor)," ")}}function k(o,l){if(1&o){const e=t.RV6();t.j41(0,"div",29)(1,"div",30)(2,"h2",31),t.EFF(3,"Agregar Nuevo Ahorro"),t.k0s(),t.j41(4,"p",32),t.EFF(5,"Introduce los detalles del nuevo ahorro."),t.k0s(),t.j41(6,"label",33),t.EFF(7,"Ahorro en:"),t.k0s(),t.j41(8,"input",34),t.mxI("ngModelChange",function(n){t.eBV(e);const r=t.XpG();return t.DH7(r.newSaving.tipo,n)||(r.newSaving.tipo=n),t.Njj(n)}),t.k0s(),t.j41(9,"label",33),t.EFF(10,"Valor:"),t.k0s(),t.j41(11,"input",35),t.bIt("input",function(n){t.eBV(e);const r=t.XpG();return t.Njj(r.onValueInput(n,"new"))}),t.k0s(),t.j41(12,"div",36)(13,"button",37),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.closeModal())}),t.EFF(14,"Cancelar"),t.k0s(),t.j41(15,"button",38),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.addSaving())}),t.EFF(16,"Agregar"),t.k0s()()()()}if(2&o){const e=t.XpG();t.R7$(8),t.R50("ngModel",e.newSaving.tipo),t.R7$(3),t.Y8G("value",e.formatCurrency(e.newSaving.valor))}}function I(o,l){if(1&o){const e=t.RV6();t.j41(0,"div",29)(1,"div",39)(2,"h2",40),t.EFF(3,"Agregar o Restar Valor"),t.k0s(),t.j41(4,"p",32),t.EFF(5,"Introduce un valor para adicionar o restar a este ahorro."),t.k0s(),t.j41(6,"label",41),t.EFF(7,"Valor:"),t.k0s(),t.j41(8,"input",42),t.bIt("input",function(n){t.eBV(e);const r=t.XpG();return t.Njj(r.onValueInput(n,"add"))}),t.k0s(),t.j41(9,"div",36)(10,"button",37),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.closeAddValueModal())}),t.EFF(11,"Cancelar"),t.k0s(),t.j41(12,"button",38),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.applyValue("subtract"))}),t.EFF(13,"Restar"),t.k0s(),t.j41(14,"button",43),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.applyValue("add"))}),t.EFF(15,"Sumar"),t.k0s()()()()}if(2&o){const e=t.XpG();t.R7$(8),t.Y8G("value",e.formatCurrency(e.newValue))}}function y(o,l){if(1&o){const e=t.RV6();t.j41(0,"div",29)(1,"div",30)(2,"h2",31),t.EFF(3,"Editar Ahorro"),t.k0s(),t.j41(4,"p",32),t.EFF(5,"Edita los detalles del ahorro."),t.k0s(),t.j41(6,"label",33),t.EFF(7,"Ahorro en:"),t.k0s(),t.j41(8,"input",44),t.mxI("ngModelChange",function(n){t.eBV(e);const r=t.XpG();return t.DH7(r.editedSaving.tipo,n)||(r.editedSaving.tipo=n),t.Njj(n)}),t.k0s(),t.j41(9,"label",33),t.EFF(10,"Valor:"),t.k0s(),t.j41(11,"input",45),t.bIt("input",function(n){t.eBV(e);const r=t.XpG();return t.Njj(r.onEditValueInput(n))}),t.k0s(),t.j41(12,"div",36)(13,"button",37),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.closeEditModal())}),t.EFF(14,"Cancelar"),t.k0s(),t.j41(15,"button",38),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.saveEditedSaving())}),t.EFF(16,"Guardar"),t.k0s()()()()}if(2&o){const e=t.XpG();t.R7$(8),t.R50("ngModel",e.editedSaving.tipo),t.R7$(3),t.Y8G("value",e.formatCurrency(e.editedSaving.valor))}}function M(o,l){if(1&o){const e=t.RV6();t.j41(0,"div",29)(1,"div",46)(2,"span",47),t.EFF(3," report_problem "),t.k0s(),t.j41(4,"h2",48),t.EFF(5,"\xbfEliminar Ahorro?"),t.k0s(),t.j41(6,"p",49),t.EFF(7,"\xbfEst\xe1s seguro de que deseas eliminar este ahorro? Esta acci\xf3n no se puede deshacer."),t.k0s(),t.j41(8,"div",50)(9,"button",51),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.closeDeleteModal())}),t.EFF(10,"Cancelar"),t.k0s(),t.j41(11,"button",52),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.confirmDeleteSaving())}),t.EFF(12," Eliminar "),t.k0s()()()()}}let C=(()=>{class o{constructor(){this.savingsService=(0,t.WQX)(_),this.decimalPipe=(0,t.WQX)(c.QX),this.dateService=(0,t.WQX)(S.k),this.authService=(0,t.WQX)(x.u),this.finanzasService=(0,t.WQX)(j.q),this.isAddValueModalOpen=!1,this.isDeleteModalOpen=!1,this.selectedSavingId=null,this.savingToDeleteId=null,this.newValue=0,this.savings=[],this.incomes=[],this.expenses=[],this.wallet=[],this.loans=[],this.estadoFinanciero="",this.estadoFinancieroColor="verde",this.cuadreDescuadre=0,this.isModalOpen=!1,this.isEditModalOpen=!1,this.newSaving=new u("",0),this.editedSaving=new u("",0),this.editedId=null,this.userId=JSON.parse(localStorage.getItem("user")||"{}").localId,this.currentYear="",this.currentMonth=""}ngOnInit(){this.dateSubscription=this.dateService.selectedDate$.subscribe(e=>{e.year&&e.month&&(this.currentYear=e.year,this.currentMonth=e.month,this.loadSavings())}),this.finanzasService.mostrarEstadoFinanciero(this,this.userId,this.currentYear,this.currentMonth)}ngOnDestroy(){this.dateSubscription?.unsubscribe()}loadSavings(){this.savingsService.getSavings(this.userId,this.currentYear,this.currentMonth).subscribe({next:e=>{this.savings=Object.entries(e).map(([i,n])=>({id:i,...n})),0===this.savings.length&&this.authService.addNotification(this.userId,"No has ahorrado este mes").subscribe()},error:e=>{console.error("Error al cargar ahorros:",e)}}),this.finanzasService.mostrarEstadoFinanciero(this,this.userId,this.currentYear,this.currentMonth)}openModal(){this.isModalOpen=!0}closeModal(){this.isModalOpen=!1,this.newSaving=new u("",0)}addSaving(){this.newSaving.tipo?this.savingsService.addSaving(this.userId,this.currentYear,this.currentMonth,this.newSaving).subscribe({next:()=>{this.loadSavings(),this.closeModal(),this.authService.addNotification(this.userId,"Has agregado dinero a tus ahorros").subscribe()},error:e=>{console.error("Error al agregar ahorro:",e)}}):alert("Por favor completa todos los campos.")}openAddModal(e){this.selectedSavingId=e,this.isAddValueModalOpen=!0}closeAddValueModal(){this.isAddValueModalOpen=!1,this.newValue=0}applyValue(e){if(!this.selectedSavingId)return;const i=this.savings.find(d=>d.id===this.selectedSavingId);if(!i)return;let n=this.newValue;n="subtract"===e?-Math.abs(this.newValue):Math.abs(this.newValue),this.savingsService.updateSaving(this.userId,this.currentYear,this.currentMonth,i.id,{tipo:i.tipo,valor:i.valor+n}).subscribe({next:()=>{this.loadSavings(),this.closeAddValueModal()},error:d=>{console.error("Error al actualizar ahorro:",d)}})}openEditModal(e){const i=this.savings.find(n=>n.id===e);i&&(this.editedSaving=new u(i.tipo,i.valor),this.editedId=e,this.isEditModalOpen=!0)}closeEditModal(){this.isEditModalOpen=!1,this.editedSaving=new u("",0),this.editedId=null}saveEditedSaving(){this.editedId&&this.savingsService.updateSaving(this.userId,this.currentYear,this.currentMonth,this.editedId,this.editedSaving).subscribe({next:()=>{this.loadSavings(),this.closeEditModal()},error:e=>{console.error("Error al actualizar ahorro:",e)}})}openDeleteModal(e){this.isDeleteModalOpen=!0,this.savingToDeleteId=e}closeDeleteModal(){this.isDeleteModalOpen=!1,this.savingToDeleteId=null}confirmDeleteSaving(){this.savingToDeleteId&&this.savingsService.deleteSaving(this.userId,this.currentYear,this.currentMonth,this.savingToDeleteId).subscribe({next:()=>{this.loadSavings(),this.closeDeleteModal()},error:e=>{console.error("Error al eliminar ahorro:",e)}})}getTotalSavings(){return this.savings.reduce((e,i)=>e+Number(i.valor),0)}formatCurrency(e){return this.decimalPipe.transform(e,"1.0-0")||""}onValueInput(e,i){const n=e.target,r=n.value.replace(/[^\d-]/g,""),s=Number(r)||0;"new"===i?this.newSaving.valor=s:"edit"===i?this.editedSaving.valor=s:"add"===i&&(this.newValue=s),n.value=this.formatCurrency(s)}onEditValueInput(e){const i=e.target,n=i.value.replace(/[^\d-]/g,""),r=Number(n)||0;this.editedSaving.valor=r,i.value=this.formatCurrency(r)}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-savings"]],standalone:!0,features:[t.Jv_([c.QX]),t.aNF],decls:37,vars:12,consts:[[1,"mb-6","grid","grid-cols-1","xl:grid-cols-2","gap-6"],[1,"relative","flex","flex-col","bg-white","rounded-xl","shadow-lg","overflow-hidden","xl:col-span-2","border","border-gray-200"],[1,"px-6","py-4","border-b","flex","center-end"],[1,"text-white","text-sm","font-semibold","px-4","py-2","rounded-full","shadow-md",3,"ngClass"],[1,"flex","items-center","justify-between","p-6","bg-gradient-to-r","from-sky-800","to-sky-800","text-white","rounded-t-xl","shadow-md"],[1,"text-xl","font-bold","tracking-wide"],[1,"text-sm","flex","items-center","gap-2","opacity-90"],[1,"overflow-x-auto"],[1,"w-full","min-w-[640px]","border-collapse"],[1,"bg-gray-100"],[1,"border-b"],[1,"py-4","px-6","text-left","text-xs","font-semibold","uppercase","text-gray-600"],[1,"py-4","px-6","text-right","text-xs","font-semibold","uppercase","text-gray-600"],[1,"py-4","px-6","text-center","text-xs","font-semibold","uppercase","text-gray-600"],["class","border-b transition duration-300 hover:bg-gray-50",4,"ngFor","ngForOf"],[1,"bg-teal-50","font-bold","text-teal-900"],[1,"py-4","px-6","text-left"],[1,"py-4","px-6","text-right"],[1,"flex","justify-end","p-4"],[1,"bg-blue-600","text-white","px-4","py-2","rounded-md","shadow-md","hover:bg-teal-500","transition",3,"click"],["class","fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-50",4,"ngIf"],[1,"border-b","transition","duration-300","hover:bg-gray-50"],[1,"py-4","px-6","font-semibold"],[1,"py-4","px-6","text-right","font-semibold","text-teal-700"],[1,"py-4","px-6","text-center"],[1,"text-lime-600","mr-2",3,"click"],[1,"material-icons"],[1,"text-sky-700","mr-2",3,"click"],[1,"text-orange-600",3,"click"],[1,"fixed","inset-0","flex","items-center","justify-center","bg-gray-900","bg-opacity-50"],[1,"bg-white","p-6","rounded-lg","shadow-lg","w-96"],[1,"text-xl","font-bold","mb-4"],[1,"text-gray-600","mb-4","text-sm"],[1,"block","mb-2"],["type","text","placeholder","Ej: Cuenta bancaria",1,"w-full","p-2","border","rounded-md","mb-3",3,"ngModelChange","ngModel"],["type","text","placeholder","Ej: 500.000",1,"w-full","p-2","border","rounded-md","mb-3",3,"input","value"],[1,"flex","justify-end","gap-2"],[1,"px-4","py-2","border","rounded-md","bg-white-700","hover:bg-slate-200",3,"click"],[1,"px-4","py-2","bg-sky-700","text-white","rounded-md","hover:bg-slate-700",3,"click"],[1,"bg-white","p-6","rounded-lg","shadow-lg","w-80"],[1,"text-xl","font-bold","mb-2"],[1,"block","mb-2","font-semibold"],["type","text","placeholder","Ej: 3000",1,"w-full","p-2","border","rounded-md","mb-4",3,"input","value"],[1,"px-4","py-2","bg-teal-700","text-white","rounded-md","hover:bg-emerald-800",3,"click"],["type","text","placeholder","Ej: Inversi\xf3n CDT",1,"w-full","p-2","border","rounded-md","mb-3",3,"ngModelChange","ngModel"],["type","text","placeholder","Ej: 1.000.000",1,"w-full","p-2","border","rounded-md","mb-3",3,"input","value"],[1,"bg-white","p-6","rounded-lg","shadow-lg","w-80","text-center"],[1,"material-icons","text-red-600","mx-auto","mb-4",2,"font-size","48px"],[1,"text-xl","font-bold","mt-4","mb-2"],[1,"mb-6","text-gray-700"],[1,"flex","justify-center","gap-2"],[1,"px-4","py-2","border","rounded-md","bg-white-700","hover:bg-orange-200",3,"click"],[1,"px-4","py-2","bg-orange-600","text-white","rounded-md","hover:bg-red-600",3,"click"]],template:function(i,n){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),t.EFF(4),t.k0s()(),t.j41(5,"div",4)(6,"div")(7,"h6",5),t.EFF(8,"Mis Ahorros"),t.k0s(),t.j41(9,"p",6)(10,"strong"),t.EFF(11,"Estado Actual"),t.k0s()()()(),t.j41(12,"div",7)(13,"table",8)(14,"thead",9)(15,"tr",10)(16,"th",11),t.EFF(17,"Ahorro en"),t.k0s(),t.j41(18,"th",12),t.EFF(19,"Valor"),t.k0s(),t.j41(20,"th",13),t.EFF(21,"Acciones"),t.k0s()()(),t.j41(22,"tbody"),t.DNE(23,E,15,2,"tr",14),t.j41(24,"tr",15)(25,"td",16),t.EFF(26,"Total"),t.k0s(),t.j41(27,"td",17),t.EFF(28),t.k0s(),t.nrm(29,"td"),t.k0s()()()(),t.j41(30,"div",18)(31,"button",19),t.bIt("click",function(){return n.openModal()}),t.EFF(32," Agregar Ahorro + "),t.k0s()(),t.DNE(33,k,17,2,"div",20)(34,I,16,1,"div",20)(35,y,17,2,"div",20)(36,M,13,0,"div",20),t.k0s()()),2&i&&(t.R7$(3),t.Y8G("ngClass",t.sMw(8,F,"rojo"===n.estadoFinancieroColor,"azul"===n.estadoFinancieroColor,"verde"===n.estadoFinancieroColor)),t.R7$(),t.SpI(" ",n.estadoFinanciero," "),t.R7$(19),t.Y8G("ngForOf",n.savings),t.R7$(5),t.SpI(" $",n.formatCurrency(n.getTotalSavings())," "),t.R7$(5),t.Y8G("ngIf",n.isModalOpen),t.R7$(),t.Y8G("ngIf",n.isAddValueModalOpen),t.R7$(),t.Y8G("ngIf",n.isEditModalOpen),t.R7$(),t.Y8G("ngIf",n.isDeleteModalOpen))},dependencies:[c.MD,c.YU,c.Sq,c.bT,p.YN,p.me,p.BC,p.vS,m.m_,m.An]})}}return o})()}}]);