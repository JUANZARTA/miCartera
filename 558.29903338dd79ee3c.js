"use strict";(self.webpackChunkmiCartera=self.webpackChunkmiCartera||[]).push([[558],{558:(D,_,l)=>{l.r(_),l.d(_,{default:()=>w});var e=l(4438),a=l(177),u=l(9417),m=l(6463),d=l(915),b=l(3062),f=l(4796),v=l(2757),g=l(9156),x=l(4497),E=l(7738),j=l(402),h=l(6672);const F=(r,s,t)=>({"bg-red-600":r,"bg-blue-600":s,"bg-green-600":t});function M(r,s){if(1&r){const t=e.RV6();e.j41(0,"tr",20)(1,"td",21),e.EFF(2),e.k0s(),e.j41(3,"td",22),e.EFF(4),e.k0s(),e.j41(5,"td",23)(6,"button",24),e.bIt("click",function(){const n=e.eBV(t).$implicit,o=e.XpG();return e.Njj(o.openAddModal(n.id))}),e.j41(7,"span",25),e.EFF(8,"add"),e.k0s()(),e.j41(9,"button",26),e.bIt("click",function(){const n=e.eBV(t).$implicit,o=e.XpG();return e.Njj(o.openEditModal(n.id))}),e.j41(10,"mat-icon"),e.EFF(11,"edit"),e.k0s()(),e.j41(12,"button",27),e.bIt("click",function(){const n=e.eBV(t).$implicit,o=e.XpG();return e.Njj(o.openDeleteModal(n.id))}),e.j41(13,"mat-icon"),e.EFF(14,"delete"),e.k0s()()()()}if(2&r){const t=s.$implicit,i=e.XpG();e.R7$(2),e.JRh(t.tipo),e.R7$(2),e.SpI(" $",i.formatCurrency(t.valor)," ")}}function k(r,s){if(1&r){const t=e.RV6();e.j41(0,"div",28)(1,"div",29)(2,"h2",30),e.EFF(3,"Agregar Nueva Cuenta"),e.k0s(),e.j41(4,"p",31),e.EFF(5,"Introduce los detalles de la nueva cuenta."),e.k0s(),e.j41(6,"label",32),e.EFF(7,"Dinero en:"),e.k0s(),e.j41(8,"input",33),e.mxI("ngModelChange",function(n){e.eBV(t);const o=e.XpG();return e.DH7(o.newAccount.tipo,n)||(o.newAccount.tipo=n),e.Njj(n)}),e.k0s(),e.j41(9,"label",32),e.EFF(10,"Valor:"),e.k0s(),e.j41(11,"input",34),e.bIt("input",function(n){e.eBV(t);const o=e.XpG();return e.Njj(o.onValueInput(n,"new"))}),e.k0s(),e.j41(12,"div",35)(13,"button",36),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.closeModal())}),e.EFF(14,"Cancelar"),e.k0s(),e.j41(15,"button",37),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.addAccount())}),e.EFF(16,"Agregar"),e.k0s()()()()}if(2&r){const t=e.XpG();e.R7$(8),e.R50("ngModel",t.newAccount.tipo),e.R7$(3),e.Y8G("value",t.formatCurrency(t.newAccount.valor))}}function I(r,s){if(1&r){const t=e.RV6();e.j41(0,"div",28)(1,"div",38)(2,"h2",39),e.EFF(3,"Agregar o Restar Valor"),e.k0s(),e.j41(4,"p",31),e.EFF(5,"Introduce un valor para adicionar o restar a esta cuenta."),e.k0s(),e.j41(6,"label",40),e.EFF(7,"Valor:"),e.k0s(),e.j41(8,"input",41),e.bIt("input",function(n){e.eBV(t);const o=e.XpG();return e.Njj(o.onValueInput(n,"add"))}),e.k0s(),e.j41(9,"div",35)(10,"button",36),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.closeAddValueModal())}),e.EFF(11,"Cancelar"),e.k0s(),e.j41(12,"button",37),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.applyValue("subtract"))}),e.EFF(13,"Restar"),e.k0s(),e.j41(14,"button",42),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.applyValue("add"))}),e.EFF(15,"Sumar"),e.k0s()()()()}if(2&r){const t=e.XpG();e.R7$(8),e.Y8G("value",t.formatCurrency(t.newValue))}}function C(r,s){if(1&r){const t=e.RV6();e.j41(0,"div",28)(1,"div",29)(2,"h2",30),e.EFF(3,"Editar Cuenta"),e.k0s(),e.j41(4,"p",31),e.EFF(5,"Edita los detalles de la cuenta."),e.k0s(),e.j41(6,"label",32),e.EFF(7,"Dinero en:"),e.k0s(),e.j41(8,"input",43),e.mxI("ngModelChange",function(n){e.eBV(t);const o=e.XpG();return e.DH7(o.editedAccount.tipo,n)||(o.editedAccount.tipo=n),e.Njj(n)}),e.k0s(),e.j41(9,"label",32),e.EFF(10,"Valor:"),e.k0s(),e.j41(11,"input",44),e.bIt("input",function(n){e.eBV(t);const o=e.XpG();return e.Njj(o.onEditValueInput(n))}),e.k0s(),e.j41(12,"div",35)(13,"button",36),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.closeEditModal())}),e.EFF(14,"Cancelar"),e.k0s(),e.j41(15,"button",37),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.saveEditedAccount())}),e.EFF(16,"Guardar"),e.k0s()()()()}if(2&r){const t=e.XpG();e.R7$(8),e.R50("ngModel",t.editedAccount.tipo),e.R7$(3),e.Y8G("value",t.formatCurrency(t.editedAccount.valor))}}function A(r,s){if(1&r){const t=e.RV6();e.j41(0,"div",28)(1,"div",45)(2,"span",46),e.EFF(3," report_problem "),e.k0s(),e.j41(4,"h2",47),e.EFF(5,"\xbfEliminar Cuenta?"),e.k0s(),e.j41(6,"p",48),e.EFF(7,"\xbfEst\xe1s seguro de que deseas eliminar esta cuenta? Esta acci\xf3n no se puede deshacer."),e.k0s(),e.j41(8,"div",49)(9,"button",50),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.closeDeleteModal())}),e.EFF(10,"Cancelar"),e.k0s(),e.j41(11,"button",51),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.confirmDeleteAccount())}),e.EFF(12," Eliminar "),e.k0s()()()()}}let w=(()=>{class r{constructor(){this.walletService=(0,e.WQX)(m.F),this.decimalPipe=(0,e.WQX)(a.QX),this.dateService=(0,e.WQX)(b.k),this.authService=(0,e.WQX)(f.u),this.loanService=(0,e.WQX)(v.a),this.debtService=(0,e.WQX)(g.V),this.incomeService=(0,e.WQX)(x.H),this.expenseService=(0,e.WQX)(E.k),this.finanzasService=(0,e.WQX)(j.q),this.isAddValueModalOpen=!1,this.isDeleteModalOpen=!1,this.selectedAccountId=null,this.accountToDeleteId=null,this.newValue=0,this.wallet=[],this.loans=[],this.debts=[],this.incomes=[],this.expenses=[],this.isModalOpen=!1,this.isEditModalOpen=!1,this.newAccount=new d.f("",0),this.editedAccount=new d.f("",0),this.editedId=null,this.estadoFinanciero="",this.estadoFinancieroColor="verde",this.cuadreDescuadreWallet=0,this.estadoCartera="",this.Math=Math,this.userId=JSON.parse(localStorage.getItem("user")||"{}").localId,this.currentYear="",this.currentMonth=""}ngOnInit(){this.dateSubscription=this.dateService.selectedDate$.subscribe(t=>{t.year&&t.month&&(this.currentYear=t.year,this.currentMonth=t.month,this.loadAllData())}),this.finanzasService.mostrarEstadoFinanciero(this,this.userId,this.currentYear,this.currentMonth)}ngOnDestroy(){this.dateSubscription?.unsubscribe()}loadAllData(){this.walletService.getWallet(this.userId,this.currentYear,this.currentMonth).subscribe({next:t=>{this.wallet=Object.entries(t||{}).map(([i,n])=>({id:i,...n})),this.checkLowFunds()}}),this.loanService.getLoans(this.userId,this.currentYear,this.currentMonth).subscribe({next:t=>{this.loans=Object.entries(t||{}).map(([i,n])=>({id:i,...n}))}}),this.debtService.getDebts(this.userId,this.currentYear,this.currentMonth).subscribe({next:t=>{this.debts=Object.entries(t||{}).map(([i,n])=>({id:i,...n}))}}),this.incomeService.getIncomes(this.userId,this.currentYear,this.currentMonth).subscribe({next:t=>{this.incomes=Object.entries(t||{}).map(([i,n])=>({id:i,...n}))}}),this.expenseService.getExpenses(this.userId,this.currentYear,this.currentMonth).subscribe({next:t=>{this.expenses=Object.entries(t||{}).map(([i,n])=>({id:i,...n}))}}),this.finanzasService.mostrarEstadoFinanciero(this,this.userId,this.currentYear,this.currentMonth)}checkLowFunds(){this.getTotalWallet()<1e5&&this.authService.addNotification(this.userId,"Tu efectivo baj\xf3 a menos de $100.000").subscribe()}openModal(){this.isModalOpen=!0}closeModal(){this.isModalOpen=!1,this.newAccount=new d.f("",0)}addAccount(){this.newAccount.tipo?this.walletService.addAccount(this.userId,this.currentYear,this.currentMonth,this.newAccount).subscribe({next:()=>{this.loadAllData(),this.closeModal()},error:t=>{console.error("Error al agregar cuenta:",t)}}):alert("Por favor completa todos los campos.")}openAddModal(t){this.selectedAccountId=t,this.isAddValueModalOpen=!0}closeAddValueModal(){this.isAddValueModalOpen=!1,this.newValue=0}applyValue(t){if(!this.selectedAccountId)return;const i=this.wallet.find(p=>p.id===this.selectedAccountId);if(!i)return;let n=this.newValue;n="subtract"===t?-Math.abs(this.newValue):Math.abs(this.newValue),this.walletService.updateAccount(this.userId,this.currentYear,this.currentMonth,i.id,{tipo:i.tipo,valor:i.valor+n}).subscribe({next:()=>{this.loadAllData(),this.closeAddValueModal()},error:p=>{console.error("Error al actualizar cuenta:",p)}})}openEditModal(t){const i=this.wallet.find(n=>n.id===t);i&&(this.editedAccount=new d.f(i.tipo,i.valor),this.editedId=t,this.isEditModalOpen=!0)}closeEditModal(){this.isEditModalOpen=!1,this.editedAccount=new d.f("",0),this.editedId=null}saveEditedAccount(){this.editedId&&this.walletService.updateAccount(this.userId,this.currentYear,this.currentMonth,this.editedId,this.editedAccount).subscribe({next:()=>{this.loadAllData(),this.closeEditModal()},error:t=>{console.error("Error al actualizar cuenta:",t)}})}openDeleteModal(t){this.isDeleteModalOpen=!0,this.accountToDeleteId=t}closeDeleteModal(){this.isDeleteModalOpen=!1,this.accountToDeleteId=null}confirmDeleteAccount(){this.accountToDeleteId&&this.walletService.deleteAccount(this.userId,this.currentYear,this.currentMonth,this.accountToDeleteId).subscribe({next:()=>{this.loadAllData(),this.closeDeleteModal()},error:t=>{console.error("Error al eliminar cuenta:",t)}})}getTotalWallet(){return this.wallet.reduce((t,i)=>t+Number(i.valor),0)}formatCurrency(t){return this.decimalPipe.transform(t,"1.0-0")||"0"}onValueInput(t,i){const n=t.target,o=n.value.replace(/[^\d-]/g,""),c=Number(o)||0;"new"===i?this.newAccount.valor=c:"edit"===i?this.editedAccount.valor=c:"add"===i&&(this.newValue=c),n.value=this.formatCurrency(c)}onEditValueInput(t){const i=t.target,n=i.value.replace(/[^\d-]/g,""),o=Number(n)||0;this.editedAccount.valor=o,i.value=this.formatCurrency(o)}static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-wallet"]],standalone:!0,features:[e.Jv_([a.QX]),e.aNF],decls:36,vars:12,consts:[[1,"mb-6","grid","grid-cols-1","xl:grid-cols-2","gap-6"],[1,"relative","flex","flex-col","bg-white","rounded-xl","shadow-lg","overflow-hidden","xl:col-span-2","border","border-gray-200"],[1,"px-6","py-4","border-b","flex","center-end"],[1,"text-white","text-sm","font-semibold","px-4","py-2","rounded-full","shadow-md",3,"ngClass"],[1,"flex","items-center","justify-between","p-6","bg-gradient-to-r","from-sky-800","to-sky-800","text-white","rounded-t-xl","shadow-md"],[1,"text-xl","font-bold","tracking-wide"],[1,"text-sm","flex","items-center","gap-2","opacity-90"],[1,"bg-white","text-blue-700","font-semibold","px-4","py-2","rounded-md","shadow-md","hover:bg-blue-100","transition",3,"click"],[1,"overflow-x-auto"],[1,"w-full","min-w-[640px]","border-collapse"],[1,"bg-gray-100"],[1,"border-b"],[1,"py-4","px-6","text-left","text-xs","font-semibold","uppercase","text-gray-600"],[1,"py-4","px-6","text-right","text-xs","font-semibold","uppercase","text-gray-600"],[1,"py-4","px-6","text-center","text-xs","font-semibold","uppercase","text-gray-600"],["class","border-b transition duration-300 hover:bg-gray-50",4,"ngFor","ngForOf"],[1,"bg-green-50","font-bold","text-green-900"],[1,"py-4","px-6","text-left"],[1,"py-4","px-6","text-right"],["class","fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-50",4,"ngIf"],[1,"border-b","transition","duration-300","hover:bg-gray-50"],[1,"py-4","px-6","font-semibold"],[1,"py-4","px-6","text-right","font-semibold","text-green-600"],[1,"py-4","px-6","text-center"],[1,"text-lime-600","mr-2",3,"click"],[1,"material-icons"],[1,"text-sky-700","mr-2",3,"click"],[1,"text-orange-600",3,"click"],[1,"fixed","inset-0","flex","items-center","justify-center","bg-gray-900","bg-opacity-50"],[1,"bg-white","p-6","rounded-lg","shadow-lg","w-96"],[1,"text-xl","font-bold","mb-4"],[1,"text-gray-600","mb-4","text-sm"],[1,"block","mb-2"],["type","text","placeholder","Ej: Cuenta de ahorros",1,"w-full","p-2","border","rounded-md","mb-3",3,"ngModelChange","ngModel"],["type","text","placeholder","Ej: 1.000.000",1,"w-full","p-2","border","rounded-md","mb-3",3,"input","value"],[1,"flex","justify-end","gap-2"],[1,"px-4","py-2","border","rounded-md","bg-white-700","hover:bg-slate-200",3,"click"],[1,"px-4","py-2","bg-sky-700","text-white","rounded-md","hover:bg-slate-700",3,"click"],[1,"bg-white","p-6","rounded-lg","shadow-lg","w-80"],[1,"text-xl","font-bold","mb-2"],[1,"block","mb-2","font-semibold"],["type","text","placeholder","Ej: 5000",1,"w-full","p-2","border","rounded-md","mb-4",3,"input","value"],[1,"px-4","py-2","bg-teal-700","text-white","rounded-md","hover:bg-emerald-800",3,"click"],["type","text","placeholder","Ej: Efectivo",1,"w-full","p-2","border","rounded-md","mb-3",3,"ngModelChange","ngModel"],["type","text","placeholder","Ej: 750.000",1,"w-full","p-2","border","rounded-md","mb-3",3,"input","value"],[1,"bg-white","p-6","rounded-lg","shadow-lg","w-80","text-center"],[1,"material-icons","text-red-600","mx-auto","mb-4",2,"font-size","48px"],[1,"text-xl","font-bold","mt-4","mb-2"],[1,"mb-6","text-gray-700"],[1,"flex","justify-center","gap-2"],[1,"px-4","py-2","border","rounded-md","bg-white-700","hover:bg-orange-200",3,"click"],[1,"px-4","py-2","bg-orange-600","text-white","rounded-md","hover:bg-red-600",3,"click"]],template:function(i,n){1&i&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),e.EFF(4),e.k0s()(),e.j41(5,"div",4)(6,"div")(7,"h6",5),e.EFF(8,"Mi Cartera"),e.k0s(),e.j41(9,"p",6)(10,"strong"),e.EFF(11,"Estado Actual"),e.k0s()()(),e.j41(12,"button",7),e.bIt("click",function(){return n.openModal()}),e.EFF(13," Agregar Cuenta + "),e.k0s()(),e.j41(14,"div",8)(15,"table",9)(16,"thead",10)(17,"tr",11)(18,"th",12),e.EFF(19,"Dinero en"),e.k0s(),e.j41(20,"th",13),e.EFF(21,"Valor"),e.k0s(),e.j41(22,"th",14),e.EFF(23,"Acciones"),e.k0s()()(),e.j41(24,"tbody"),e.DNE(25,M,15,2,"tr",15),e.j41(26,"tr",16)(27,"td",17),e.EFF(28,"Total"),e.k0s(),e.j41(29,"td",18),e.EFF(30),e.k0s(),e.nrm(31,"td"),e.k0s()()()(),e.DNE(32,k,17,2,"div",19)(33,I,16,1,"div",19)(34,C,17,2,"div",19)(35,A,13,0,"div",19),e.k0s()()),2&i&&(e.R7$(3),e.Y8G("ngClass",e.sMw(8,F,"rojo"===n.estadoFinancieroColor,"azul"===n.estadoFinancieroColor,"verde"===n.estadoFinancieroColor)),e.R7$(),e.SpI(" ",n.estadoFinanciero," "),e.R7$(21),e.Y8G("ngForOf",n.wallet),e.R7$(5),e.SpI(" $",n.formatCurrency(n.getTotalWallet())," "),e.R7$(2),e.Y8G("ngIf",n.isModalOpen),e.R7$(),e.Y8G("ngIf",n.isAddValueModalOpen),e.R7$(),e.Y8G("ngIf",n.isEditModalOpen),e.R7$(),e.Y8G("ngIf",n.isDeleteModalOpen))},dependencies:[a.MD,a.YU,a.Sq,a.bT,u.YN,u.me,u.BC,u.vS,h.m_,h.An]})}}return r})()}}]);