"use strict";(self.webpackChunkmiCartera=self.webpackChunkmiCartera||[]).push([[940],{8940:(v,u,c)=>{c.r(u),c.d(u,{default:()=>j});var e=c(4438),d=c(177),l=c(9417),p=c(4497),a=function(r){return r.Fijo="Fijo",r.Variable="Variable",r.Otro="Otro",r}(a||{});class m{constructor(s,t,o){this.nombre=s,this.categoria=t,this.valor=o}}var g=c(3062),h=c(4796);function b(r,s){if(1&r){const t=e.RV6();e.j41(0,"tr",23)(1,"td",24),e.EFF(2),e.k0s(),e.j41(3,"td",25),e.EFF(4),e.k0s(),e.j41(5,"td",26)(6,"button",27),e.bIt("click",function(){const n=e.eBV(t).$implicit,i=e.XpG(2);return e.Njj(i.openEditModal(n.id))}),e.EFF(7,"\u270f\ufe0f"),e.k0s(),e.j41(8,"button",28),e.bIt("click",function(){const n=e.eBV(t).$implicit,i=e.XpG(2);return e.Njj(i.deleteIncome(n.id))}),e.EFF(9,"\u{1f5d1}\ufe0f"),e.k0s()()()}if(2&r){const t=s.$implicit,o=e.XpG(2);e.R7$(2),e.JRh(t.nombre),e.R7$(2),e.SpI(" $",o.formatCurrency(t.valor)," ")}}function _(r,s){if(1&r&&(e.j41(0,"details",13)(1,"summary",14)(2,"span",15),e.EFF(3),e.k0s(),e.j41(4,"div",16)(5,"span",17),e.EFF(6),e.k0s()()(),e.j41(7,"div",4)(8,"table",8)(9,"thead",18)(10,"tr")(11,"th",19),e.EFF(12,"Nombre"),e.k0s(),e.j41(13,"th",20),e.EFF(14,"Gastado"),e.k0s(),e.j41(15,"th",21),e.EFF(16,"Acciones"),e.k0s()()(),e.j41(17,"tbody"),e.DNE(18,b,10,2,"tr",22),e.k0s()()()()),2&r){const t=s.$implicit,o=e.XpG();e.R7$(3),e.Lme(" ",t.categoria," (",t.items.length," ingresos) "),e.R7$(3),e.SpI("Ingresos: $",o.formatCurrency(o.getGroupTotal(t.items)),""),e.R7$(12),e.Y8G("ngForOf",t.items)}}function f(r,s){if(1&r&&(e.j41(0,"option",40),e.EFF(1),e.k0s()),2&r){const t=s.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",t," ")}}function I(r,s){if(1&r){const t=e.RV6();e.j41(0,"div",29)(1,"div",30)(2,"h2",31),e.EFF(3,"Agregar Nuevo Ingreso"),e.k0s(),e.j41(4,"label",32),e.EFF(5,"Nombre:"),e.k0s(),e.j41(6,"input",33),e.mxI("ngModelChange",function(n){e.eBV(t);const i=e.XpG();return e.DH7(i.newIncome.nombre,n)||(i.newIncome.nombre=n),e.Njj(n)}),e.k0s(),e.j41(7,"label",32),e.EFF(8,"Categor\xeda:"),e.k0s(),e.j41(9,"select",34),e.mxI("ngModelChange",function(n){e.eBV(t);const i=e.XpG();return e.DH7(i.newIncome.categoria,n)||(i.newIncome.categoria=n),e.Njj(n)}),e.DNE(10,f,2,2,"option",35),e.k0s(),e.j41(11,"label",32),e.EFF(12,"Valor:"),e.k0s(),e.j41(13,"input",36),e.bIt("input",function(n){e.eBV(t);const i=e.XpG();return e.Njj(i.onValueInput(n))}),e.k0s(),e.j41(14,"div",37)(15,"button",38),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.closeModal())}),e.EFF(16,"Cancelar"),e.k0s(),e.j41(17,"button",39),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.addIncome())}),e.EFF(18,"Agregar"),e.k0s()()()()}if(2&r){const t=e.XpG();e.R7$(6),e.R50("ngModel",t.newIncome.nombre),e.R7$(3),e.R50("ngModel",t.newIncome.categoria),e.R7$(),e.Y8G("ngForOf",t.categorias),e.R7$(3),e.Y8G("value",t.formatCurrency(t.newIncome.valor))}}function x(r,s){if(1&r&&(e.j41(0,"option",40),e.EFF(1),e.k0s()),2&r){const t=s.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",t," ")}}function F(r,s){if(1&r){const t=e.RV6();e.j41(0,"div",29)(1,"div",30)(2,"h2",31),e.EFF(3,"Editar Ingreso"),e.k0s(),e.j41(4,"label",32),e.EFF(5,"Nombre:"),e.k0s(),e.j41(6,"input",41),e.mxI("ngModelChange",function(n){e.eBV(t);const i=e.XpG();return e.DH7(i.editedIncome.nombre,n)||(i.editedIncome.nombre=n),e.Njj(n)}),e.k0s(),e.j41(7,"label",32),e.EFF(8,"Categor\xeda:"),e.k0s(),e.j41(9,"select",34),e.mxI("ngModelChange",function(n){e.eBV(t);const i=e.XpG();return e.DH7(i.editedIncome.categoria,n)||(i.editedIncome.categoria=n),e.Njj(n)}),e.DNE(10,x,2,2,"option",35),e.k0s(),e.j41(11,"label",32),e.EFF(12,"Valor:"),e.k0s(),e.j41(13,"input",42),e.bIt("input",function(n){e.eBV(t);const i=e.XpG();return e.Njj(i.onEditValueInput(n))}),e.k0s(),e.j41(14,"div",37)(15,"button",38),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.closeEditModal())}),e.EFF(16,"Cancelar"),e.k0s(),e.j41(17,"button",39),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.saveEditedIncome())}),e.EFF(18,"Guardar"),e.k0s()()()()}if(2&r){const t=e.XpG();e.R7$(6),e.R50("ngModel",t.editedIncome.nombre),e.R7$(3),e.R50("ngModel",t.editedIncome.categoria),e.R7$(),e.Y8G("ngForOf",t.categorias),e.R7$(3),e.Y8G("value",t.formatCurrency(t.editedIncome.valor))}}let j=(()=>{class r{constructor(){this.incomeService=(0,e.WQX)(p.H),this.decimalPipe=(0,e.WQX)(d.QX),this.dateService=(0,e.WQX)(g.k),this.authService=(0,e.WQX)(h.u),this.incomes=[],this.isModalOpen=!1,this.isEditModalOpen=!1,this.categorias=Object.values(a),this.newIncome=new m("",a.Fijo,null),this.editedIncome=new m("",a.Fijo,null),this.editedId=null,this.userId=JSON.parse(localStorage.getItem("user")||"{}").localId,this.currentYear="",this.currentMonth=""}ngOnInit(){this.dateSubscription=this.dateService.selectedDate$.subscribe(t=>{t.year&&t.month&&(this.currentYear=t.year,this.currentMonth=t.month,this.loadIncomes())})}ngOnDestroy(){this.dateSubscription?.unsubscribe()}loadIncomes(){this.incomeService.getIncomes(this.userId,this.currentYear,this.currentMonth).subscribe({next:t=>{this.incomes=Object.entries(t).map(([o,n])=>({id:o,...n}))},error:t=>{console.error("\u274c Error al cargar ingresos:",t)}})}openModal(){this.isModalOpen=!0}closeModal(){this.isModalOpen=!1,this.newIncome=new m("",a.Fijo,null)}addIncome(){this.newIncome.nombre&&this.newIncome.categoria?this.incomeService.addIncome(this.userId,this.currentYear,this.currentMonth,this.newIncome).subscribe({next:()=>{this.loadIncomes(),this.closeModal(),this.authService.addNotification(this.userId,"Nuevo ingreso registrado").subscribe()}}):alert("Por favor completa todos los campos.")}openEditModal(t){const o=this.incomes.find(n=>n.id===t);o&&(this.editedIncome=new m(o.nombre,o.categoria,o.valor),this.editedId=t,this.isEditModalOpen=!0)}closeEditModal(){this.isEditModalOpen=!1,this.editedIncome=new m("",a.Fijo,null),this.editedId=null}saveEditedIncome(){this.editedId&&this.incomeService.updateIncome(this.userId,this.currentYear,this.currentMonth,this.editedId,this.editedIncome).subscribe({next:()=>{this.loadIncomes(),this.closeEditModal()},error:t=>{console.error("\u274c Error al actualizar ingreso:",t)}})}deleteIncome(t){confirm("\xbfEst\xe1s seguro de eliminar este ingreso?")&&this.incomeService.deleteIncome(this.userId,this.currentYear,this.currentMonth,t).subscribe({next:()=>{this.loadIncomes()},error:n=>{console.error("\u274c Error al eliminar ingreso:",n)}})}getTotalIncome(){return this.incomes.reduce((t,o)=>t+Number(o.valor),0)}formatCurrency(t){return this.decimalPipe.transform(t,"1.0-0")||""}getGroupedIncomes(){const t=new Map;for(const o of this.incomes){const n=o.categoria;t.has(n)||t.set(n,[]),t.get(n).push(o)}return Array.from(t.entries()).map(([o,n])=>({categoria:o,items:n}))}getGroupTotal(t){return t.reduce((o,n)=>o+(Number(n.valor)||0),0)}onValueInput(t){const o=t.target,n=o.value.replace(/[.,]/g,""),i=Number(n)||0;this.newIncome.valor=i,o.value=this.formatCurrency(i)}onEditValueInput(t){const o=t.target,n=o.value.replace(/[.,]/g,""),i=Number(n)||0;this.editedIncome.valor=i,o.value=this.formatCurrency(i)}static#e=this.\u0275fac=function(o){return new(o||r)};static#t=this.\u0275cmp=e.VBU({type:r,selectors:[["app-income"]],standalone:!0,features:[e.Jv_([d.QX]),e.aNF],decls:23,vars:4,consts:[[1,"flex","items-center","justify-between","p-6","bg-gradient-to-r","from-blue-700","to-blue-500","text-white","rounded-t-xl","shadow-md"],[1,"text-xl","font-bold","tracking-wide"],[1,"text-sm","flex","items-center","gap-2","opacity-90"],[1,"bg-white","text-blue-700","font-semibold","px-4","py-2","rounded-md","shadow-md","hover:bg-blue-100","transition",3,"click"],[1,"overflow-x-auto"],[1,"space-y-4"],["open","","class","border border-gray-300 rounded-md",4,"ngFor","ngForOf"],[1,"overflow-x-auto","mt-4"],[1,"w-full","min-w-[640px]","border-collapse","text-sm"],[1,"bg-blue-100","font-bold","text-blue-900","border-t"],[1,"py-3","px-2","sm:px-4","text-left"],[1,"py-3","px-2","sm:px-4","text-right"],["class","fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-50",4,"ngIf"],["open","",1,"border","border-gray-300","rounded-md"],[1,"bg-gradient-to-r","from-cyan-700","to-cyan-500","text-white","p-4","cursor-pointer","font-bold","select-none","flex","flex-col","sm:flex-row","sm:items-center","sm:justify-between","px-2","sm:px-4","py-3","gap-y-1"],[1,"text-lg"],[1,"flex","flex-col","sm:flex-row","sm:items-center","sm:gap-10","text-sm","sm:text-base","font-bold","text-white","sm:pr-4","sm:pt-[2px]"],[1,"sm:w-32","text-right"],[1,"bg-gray-50"],[1,"text-left","py-2","px-2","sm:px-4"],[1,"text-right","py-2","px-2","sm:px-4"],[1,"text-center","py-2","px-2","sm:px-4"],["class","border-t",4,"ngFor","ngForOf"],[1,"border-t"],[1,"py-2","px-2","sm:px-4"],[1,"py-2","px-2","sm:px-4","text-right"],[1,"py-2","px-2","sm:px-4","text-center"],[1,"text-blue-600","mr-2",3,"click"],[1,"text-red-600",3,"click"],[1,"fixed","inset-0","flex","items-center","justify-center","bg-gray-900","bg-opacity-50"],[1,"bg-white","p-6","rounded-lg","shadow-lg","w-96"],[1,"text-xl","font-bold","mb-4"],[1,"block","mb-2"],["type","text","placeholder","Ejm: Sueldo",1,"w-full","p-2","border","rounded-md","mb-3",3,"ngModelChange","ngModel"],[1,"w-full","p-2","border","rounded-md","mb-3",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","text","placeholder","Ejm: 1.000.000",1,"w-full","p-2","border","rounded-md","mb-3",3,"input","value"],[1,"flex","justify-end","gap-2"],[1,"px-4","py-2","border","rounded-md",3,"click"],[1,"px-4","py-2","bg-green-500","text-white","rounded-md",3,"click"],[3,"value"],["type","text","placeholder","Ejm: Pago proyecto",1,"w-full","p-2","border","rounded-md","mb-3",3,"ngModelChange","ngModel"],["type","text","placeholder","Ejm: 800.000",1,"w-full","p-2","border","rounded-md","mb-3",3,"input","value"]],template:function(o,n){1&o&&(e.j41(0,"div",0)(1,"div")(2,"h6",1),e.EFF(3,"Tabla de Ingresos"),e.k0s(),e.j41(4,"p",2)(5,"strong"),e.EFF(6,"Mes de Enero"),e.k0s()()(),e.j41(7,"button",3),e.bIt("click",function(){return n.openModal()}),e.EFF(8," Agregar Ingreso + "),e.k0s()(),e.j41(9,"div",4)(10,"div",5),e.DNE(11,_,19,4,"details",6),e.k0s(),e.j41(12,"div",7)(13,"table",8)(14,"tbody")(15,"tr",9)(16,"td",10),e.EFF(17,"Totales Generales"),e.k0s(),e.j41(18,"td",11),e.EFF(19),e.k0s(),e.nrm(20,"td"),e.k0s()()()()(),e.DNE(21,I,19,4,"div",12)(22,F,19,4,"div",12)),2&o&&(e.R7$(11),e.Y8G("ngForOf",n.getGroupedIncomes()),e.R7$(8),e.SpI(" $",n.formatCurrency(n.getTotalIncome())," "),e.R7$(2),e.Y8G("ngIf",n.isModalOpen),e.R7$(),e.Y8G("ngIf",n.isEditModalOpen))},dependencies:[d.MD,d.Sq,d.bT,l.YN,l.xH,l.y7,l.me,l.wz,l.BC,l.vS]})}return r})()}}]);