"use strict";(self.webpackChunkmiCartera=self.webpackChunkmiCartera||[]).push([[667],{3667:(y,m,a)=>{a.r(m),a.d(m,{default:()=>k});var e=a(4438),l=a(177),p=a(9417),x=a(7738),c=function(i){return i.Fijo="Fijo",i.Variable="Variables",i.Facturas="Facturas",i.Comida="Comida",i.Transporte="Transporte",i.Salud="Salud",i.Entretenimiento="Entretenimiento",i.Emergencia="Emergencia",i.Otro="Otro",i}(c||{});class d{constructor(o,t,s,n){this.descripcion=o,this.categoria=t,this.valor=s,this.estimacion=n}}var E=a(3062),h=a(4796);const g=i=>({"bg-red-100":i});function _(i,o){if(1&i){const t=e.RV6();e.j41(0,"tr",24)(1,"td",25),e.EFF(2),e.k0s(),e.j41(3,"td",26),e.EFF(4),e.k0s(),e.j41(5,"td",26),e.EFF(6),e.k0s(),e.j41(7,"td",27)(8,"button",28),e.bIt("click",function(){const n=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.openEditModal(n.id))}),e.EFF(9," \u270f\ufe0f "),e.k0s(),e.j41(10,"button",29),e.bIt("click",function(){const n=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.deleteExpense(n.id))}),e.EFF(11," \u{1f5d1}\ufe0f "),e.k0s()()()}if(2&i){const t=o.$implicit,s=e.XpG(2);e.Y8G("ngClass",e.eq3(4,g,t.valor>t.estimacion)),e.R7$(2),e.JRh(t.descripcion),e.R7$(2),e.SpI(" $",s.formatCurrency(t.valor)," "),e.R7$(2),e.SpI(" $",s.formatCurrency(t.estimacion)," ")}}function b(i,o){if(1&i&&(e.j41(0,"details",13)(1,"summary",14)(2,"span",15),e.EFF(3),e.k0s(),e.j41(4,"div",16)(5,"span",17),e.EFF(6),e.k0s(),e.j41(7,"span",18),e.EFF(8),e.k0s()()(),e.j41(9,"div",4)(10,"table",8)(11,"thead",19)(12,"tr")(13,"th",20),e.EFF(14,"Descripci\xf3n"),e.k0s(),e.j41(15,"th",21),e.EFF(16,"Gastado"),e.k0s(),e.j41(17,"th",21),e.EFF(18,"Estimaci\xf3n"),e.k0s(),e.j41(19,"th",22),e.EFF(20,"Acciones"),e.k0s()()(),e.j41(21,"tbody"),e.DNE(22,_,12,6,"tr",23),e.k0s()()()()),2&i){const t=o.$implicit,s=e.XpG();e.R7$(3),e.Lme(" ",t.categoria," (",t.items.length," gastos) "),e.R7$(3),e.SpI("Gastado: $",s.formatCurrency(s.getGroupTotal(t.items)),""),e.R7$(2),e.SpI("Estimaci\xf3n: $",s.formatCurrency(s.getGroupEstimatedTotal(t.items)),""),e.R7$(14),e.Y8G("ngForOf",t.items)}}function f(i,o){if(1&i&&(e.j41(0,"option",42),e.EFF(1),e.k0s()),2&i){const t=o.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",t," ")}}function F(i,o){if(1&i){const t=e.RV6();e.j41(0,"div",30)(1,"div",31)(2,"h2",32),e.EFF(3,"Agregar Nuevo Gasto"),e.k0s(),e.j41(4,"label",33),e.EFF(5,"Descripci\xf3n:"),e.k0s(),e.j41(6,"input",34),e.mxI("ngModelChange",function(n){e.eBV(t);const r=e.XpG();return e.DH7(r.newExpense.descripcion,n)||(r.newExpense.descripcion=n),e.Njj(n)}),e.k0s(),e.j41(7,"label",33),e.EFF(8,"Categor\xeda:"),e.k0s(),e.j41(9,"select",35),e.mxI("ngModelChange",function(n){e.eBV(t);const r=e.XpG();return e.DH7(r.newExpense.categoria,n)||(r.newExpense.categoria=n),e.Njj(n)}),e.DNE(10,f,2,2,"option",36),e.k0s(),e.j41(11,"label",33),e.EFF(12,"Valor:"),e.k0s(),e.j41(13,"input",37),e.bIt("input",function(n){e.eBV(t);const r=e.XpG();return e.Njj(r.onValueInput(n,"valor"))}),e.k0s(),e.j41(14,"label",33),e.EFF(15,"Estimaci\xf3n:"),e.k0s(),e.j41(16,"input",38),e.bIt("input",function(n){e.eBV(t);const r=e.XpG();return e.Njj(r.onValueInput(n,"estimacion"))}),e.k0s(),e.j41(17,"div",39)(18,"button",40),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.closeModal())}),e.EFF(19," Cancelar "),e.k0s(),e.j41(20,"button",41),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.addExpense())}),e.EFF(21," Agregar "),e.k0s()()()()}if(2&i){const t=e.XpG();e.R7$(6),e.R50("ngModel",t.newExpense.descripcion),e.R7$(3),e.R50("ngModel",t.newExpense.categoria),e.R7$(),e.Y8G("ngForOf",t.categorias),e.R7$(3),e.Y8G("value",t.formatCurrency(t.newExpense.valor)),e.R7$(3),e.Y8G("value",t.formatCurrency(t.newExpense.estimacion))}}function j(i,o){if(1&i&&(e.j41(0,"option",42),e.EFF(1),e.k0s()),2&i){const t=o.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",t," ")}}function v(i,o){if(1&i){const t=e.RV6();e.j41(0,"div",30)(1,"div",31)(2,"h2",32),e.EFF(3,"Editar Gasto"),e.k0s(),e.j41(4,"label",33),e.EFF(5,"Descripci\xf3n:"),e.k0s(),e.j41(6,"input",43),e.mxI("ngModelChange",function(n){e.eBV(t);const r=e.XpG();return e.DH7(r.editedExpense.descripcion,n)||(r.editedExpense.descripcion=n),e.Njj(n)}),e.k0s(),e.j41(7,"label",33),e.EFF(8,"Categor\xeda:"),e.k0s(),e.j41(9,"select",35),e.mxI("ngModelChange",function(n){e.eBV(t);const r=e.XpG();return e.DH7(r.editedExpense.categoria,n)||(r.editedExpense.categoria=n),e.Njj(n)}),e.DNE(10,j,2,2,"option",36),e.k0s(),e.j41(11,"label",33),e.EFF(12,"Valor:"),e.k0s(),e.j41(13,"input",44),e.bIt("input",function(n){e.eBV(t);const r=e.XpG();return e.Njj(r.onEditValueInput(n,"valor"))}),e.k0s(),e.j41(14,"label",33),e.EFF(15,"Estimaci\xf3n:"),e.k0s(),e.j41(16,"input",45),e.bIt("input",function(n){e.eBV(t);const r=e.XpG();return e.Njj(r.onEditValueInput(n,"estimacion"))}),e.k0s(),e.j41(17,"div",39)(18,"button",40),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.closeEditModal())}),e.EFF(19," Cancelar "),e.k0s(),e.j41(20,"button",41),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.saveEditedExpense())}),e.EFF(21," Guardar "),e.k0s()()()()}if(2&i){const t=e.XpG();e.R7$(6),e.R50("ngModel",t.editedExpense.descripcion),e.R7$(3),e.R50("ngModel",t.editedExpense.categoria),e.R7$(),e.Y8G("ngForOf",t.categorias),e.R7$(3),e.Y8G("value",t.formatCurrency(t.editedExpense.valor)),e.R7$(3),e.Y8G("value",t.formatCurrency(t.editedExpense.estimacion))}}let k=(()=>{class i{constructor(){this.expenseService=(0,e.WQX)(x.k),this.decimalPipe=(0,e.WQX)(l.QX),this.dateService=(0,e.WQX)(E.k),this.authService=(0,e.WQX)(h.u),this.expenses=[],this.isModalOpen=!1,this.isEditModalOpen=!1,this.categorias=Object.values(c),this.newExpense=new d("",c.Variable,null,null),this.editedExpense=new d("",c.Variable,null,null),this.editedId=null,this.userId=JSON.parse(localStorage.getItem("user")||"{}").localId,this.currentYear="",this.currentMonth=""}ngOnInit(){this.dateSubscription=this.dateService.selectedDate$.subscribe(t=>{t.year&&t.month&&(this.currentYear=t.year,this.currentMonth=t.month,this.loadExpenses())})}ngOnDestroy(){this.dateSubscription?.unsubscribe()}loadExpenses(){this.expenseService.getExpenses(this.userId,this.currentYear,this.currentMonth).subscribe({next:t=>{this.expenses=Object.entries(t).map(([s,n])=>({id:s,...n}))},error:t=>{console.error("\u274c Error al cargar gastos:",t)}})}openModal(){this.isModalOpen=!0}closeModal(){this.isModalOpen=!1,this.newExpense=new d("",c.Variable,0,0)}addExpense(){this.newExpense.descripcion&&this.newExpense.categoria?this.expenseService.addExpense(this.userId,this.currentYear,this.currentMonth,this.newExpense).subscribe({next:()=>{this.loadExpenses(),this.closeModal(),this.newExpense.valor>1e5&&this.authService.addNotification(this.userId,`Gasto alto registrado: $${this.newExpense.valor}`).subscribe(),this.newExpense.estimacion&&this.newExpense.valor>this.newExpense.estimacion&&this.authService.addNotification(this.userId,`Superaste la estimaci\xf3n para ${this.newExpense.categoria}`).subscribe();const t=this.getTotalExpenses()+this.newExpense.valor,s=this.getTotalEstimations()+this.newExpense.estimacion,n=t/s*100;s>0&&n>=80&&this.authService.addNotification(this.userId,`Ya has gastado el ${n.toFixed(0)}% de tu presupuesto mensual`).subscribe()}}):alert("Por favor completa todos los campos.")}openEditModal(t){const s=this.expenses.find(n=>n.id===t);s&&(this.editedExpense=new d(s.descripcion,s.categoria,s.valor,s.estimacion),this.editedId=t,this.isEditModalOpen=!0)}closeEditModal(){this.isEditModalOpen=!1,this.editedExpense=new d("",c.Variable,0,0),this.editedId=null}saveEditedExpense(){this.editedId&&this.expenseService.updateExpense(this.userId,this.currentYear,this.currentMonth,this.editedId,this.editedExpense).subscribe({next:()=>{this.loadExpenses(),this.closeEditModal()}})}deleteExpense(t){confirm("\xbfEst\xe1s seguro de eliminar este gasto?")&&this.expenseService.deleteExpense(this.userId,this.currentYear,this.currentMonth,t).subscribe({next:()=>{this.loadExpenses()}})}getTotalExpenses(){return this.expenses.reduce((t,s)=>t+Number(s.valor),0)}getTotalEstimated(){return this.expenses.reduce((t,s)=>t+Number(s.estimacion),0)}formatCurrency(t){return this.decimalPipe.transform(t,"1.0-0")||""}isOverBudget(t){return Number(t.valor)>Number(t.estimacion)}getGroupedExpenses(){const t=new Map;for(const s of this.expenses){const n=s.categoria;t.has(n)||t.set(n,[]),t.get(n).push(s)}return Array.from(t.entries()).map(([s,n])=>({categoria:s,items:n}))}getGroupTotal(t){return t.reduce((s,n)=>s+(Number(n.valor)||0),0)}getGroupEstimatedTotal(t){return t.reduce((s,n)=>s+(Number(n.estimacion)||0),0)}getTotalEstimations(){return this.expenses.reduce((t,s)=>t+(Number(s.estimacion)||0),0)}onValueInput(t,s){const n=t.target,r=n.value.replace(/[.,]/g,""),u=Number(r)||0;this.newExpense[s]=u,n.value=this.formatCurrency(u)}onEditValueInput(t,s){const n=t.target,r=n.value.replace(/[.,]/g,""),u=Number(r)||0;this.editedExpense[s]=u,n.value=this.formatCurrency(u)}static{this.\u0275fac=function(s){return new(s||i)}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-expense"]],standalone:!0,features:[e.Jv_([l.QX]),e.aNF],decls:25,vars:5,consts:[[1,"flex","items-center","justify-between","p-6","bg-gradient-to-r","from-blue-700","to-blue-500","text-white","rounded-t-xl","shadow-md"],[1,"text-xl","font-bold","tracking-wide"],[1,"text-sm","flex","items-center","gap-2","opacity-90"],[1,"bg-white","text-blue-700","font-semibold","px-4","py-2","rounded-md","shadow-md","hover:bg-blue-100","transition",3,"click"],[1,"overflow-x-auto"],[1,"space-y-4"],["open","","class","border border-gray-300 rounded-md",4,"ngFor","ngForOf"],[1,"overflow-x-auto","mt-4"],[1,"w-full","min-w-[640px]","border-collapse","text-sm"],[1,"bg-blue-100","font-bold","text-blue-900","border-t"],[1,"py-3","px-2","sm:px-4","text-left"],[1,"py-3","px-2","sm:px-4","text-right"],["class","fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-50",4,"ngIf"],["open","",1,"border","border-gray-300","rounded-md"],[1,"bg-gradient-to-r","from-cyan-700","to-cyan-500","text-white","p-4","cursor-pointer","font-bold","select-none","flex","flex-col","sm:flex-row","sm:items-center","sm:justify-between","px-2","sm:px-4","py-3","gap-y-1"],[1,"text-lg"],[1,"flex","flex-col","sm:flex-row","sm:items-center","sm:gap-10","text-sm","sm:text-base","font-bold","text-white","sm:pr-4","sm:pt-[2px]"],[1,"sm:w-32","text-right"],[1,"sm:w-40","text-right"],[1,"bg-gray-50"],[1,"text-left","py-2","px-4","sm:px-4"],[1,"text-right","py-2","px-4","sm:px-4"],[1,"text-center","py-2","px-4","sm:px-4"],["class","border-t",3,"ngClass",4,"ngFor","ngForOf"],[1,"border-t",3,"ngClass"],[1,"py-2","px-2","sm:px-4"],[1,"py-2","px-2","sm:px-4","text-right"],[1,"py-2","px-2","sm:px-4","text-center"],[1,"text-blue-600","mr-2",3,"click"],[1,"text-red-600",3,"click"],[1,"fixed","inset-0","flex","items-center","justify-center","bg-gray-900","bg-opacity-50"],[1,"bg-white","p-6","rounded-lg","shadow-lg","w-96"],[1,"text-xl","font-bold","mb-4"],[1,"block","mb-2"],["type","text","placeholder","Ejm: Supermercado",1,"w-full","p-2","border","rounded-md","mb-3",3,"ngModelChange","ngModel"],[1,"w-full","p-2","border","rounded-md","mb-3",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","text","placeholder","Ejm: 35.400",1,"w-full","p-2","border","rounded-md","mb-3",3,"input","value"],["type","text","placeholder","Ejm: 30.000",1,"w-full","p-2","border","rounded-md","mb-3",3,"input","value"],[1,"flex","justify-end","gap-2"],[1,"px-4","py-2","border","rounded-md",3,"click"],[1,"px-4","py-2","bg-green-500","text-white","rounded-md",3,"click"],[3,"value"],["type","text","placeholder","Ejm: Alquiler",1,"w-full","p-2","border","rounded-md","mb-3",3,"ngModelChange","ngModel"],["type","text","placeholder","Ejm: 50.000",1,"w-full","p-2","border","rounded-md","mb-3",3,"input","value"],["type","text","placeholder","Ejm: 48.000",1,"w-full","p-2","border","rounded-md","mb-3",3,"input","value"]],template:function(s,n){1&s&&(e.j41(0,"div",0)(1,"div")(2,"h6",1),e.EFF(3,"Tabla de Gastos"),e.k0s(),e.j41(4,"p",2)(5,"strong"),e.EFF(6,"Mes de Enero"),e.k0s()()(),e.j41(7,"button",3),e.bIt("click",function(){return n.openModal()}),e.EFF(8," Agregar Gasto + "),e.k0s()(),e.j41(9,"div",4)(10,"div",5),e.DNE(11,b,23,5,"details",6),e.k0s(),e.j41(12,"div",7)(13,"table",8)(14,"tbody")(15,"tr",9)(16,"td",10),e.EFF(17,"Totales Generales"),e.k0s(),e.j41(18,"td",11),e.EFF(19),e.k0s(),e.j41(20,"td",11),e.EFF(21),e.k0s(),e.nrm(22,"td"),e.k0s()()()()(),e.DNE(23,F,22,5,"div",12)(24,v,22,5,"div",12)),2&s&&(e.R7$(11),e.Y8G("ngForOf",n.getGroupedExpenses()),e.R7$(8),e.SpI(" Gastado: $",n.formatCurrency(n.getTotalExpenses())," "),e.R7$(2),e.SpI(" Estimado: $",n.formatCurrency(n.getTotalEstimations())," "),e.R7$(2),e.Y8G("ngIf",n.isModalOpen),e.R7$(),e.Y8G("ngIf",n.isEditModalOpen))},dependencies:[l.MD,l.YU,l.Sq,l.bT,p.YN,p.xH,p.y7,p.me,p.wz,p.BC,p.vS]})}}return i})()}}]);