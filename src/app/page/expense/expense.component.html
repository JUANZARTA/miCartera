<!-- Encabezado -->
<div
  class="flex items-center justify-between p-6 bg-gradient-to-r from-blue-700 to-blue-500 text-white rounded-t-xl shadow-md">
  <div>
    <h6 class="text-xl font-bold tracking-wide">Tabla de Gastos</h6>
    <p class="text-sm flex items-center gap-2 opacity-90">
      <strong>Mes de Enero</strong>
    </p>
  </div>
  <button (click)="openModal()"
    class="bg-white text-blue-700 font-semibold px-4 py-2 rounded-md shadow-md hover:bg-blue-100 transition">
    Agregar Gasto +
  </button>
</div>

<!-- Tabla de Gastos -->
<div class="overflow-x-auto">
  <div class="space-y-4">
    <details *ngFor="let grupo of getGroupedExpenses()" open class="border border-gray-300 rounded-md">
      <summary
      class="bg-gradient-to-r from-cyan-700 to-cyan-500 text-white p-4 cursor-pointer font-bold select-none flex flex-col sm:flex-row sm:items-center sm:justify-between px-2 sm:px-4 py-3 gap-y-1"
    >
      <span class="text-lg">
        {{ grupo.categoria }} ({{ grupo.items.length }} gastos)
      </span>

      <!-- Totales alineados como columnas -->
      <div class="flex flex-col sm:flex-row sm:items-center sm:gap-10 text-sm sm:text-base font-bold text-white sm:pr-4 sm:pt-[2px]">
        <span class="sm:w-32 text-right">Gastado: ${{ formatCurrency(getGroupTotal(grupo.items)) }}</span>
        <span class="sm:w-40 text-right">Estimaci√≥n: ${{ formatCurrency(getGroupEstimatedTotal(grupo.items)) }}</span>
      </div>
    </summary>



      <div class="overflow-x-auto">
        <table class="w-full min-w-[640px] border-collapse text-sm">
          <thead class="bg-gray-50">
            <tr>
              <th class="text-left py-2 px-4 sm:px-4">Descripci√≥n</th>
              <th class="text-right py-2 px-4 sm:px-4">Gastado</th>
              <th class="text-right py-2 px-4 sm:px-4">Estimaci√≥n</th>
              <th class="text-center py-2 px-4 sm:px-4">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let expense of grupo.items; let i = index" class="border-t"
              [ngClass]="{ 'bg-red-100': expense.valor > expense.estimacion }">
              <td class="py-2 px-2 sm:px-4">{{ expense.descripcion }}</td>
              <td class="py-2 px-2 sm:px-4 text-right">
                ${{ formatCurrency(expense.valor) }}
              </td>
              <td class="py-2 px-2 sm:px-4 text-right">
                ${{ formatCurrency(expense.estimacion) }}
              </td>
              <td class="py-2 px-2 sm:px-4 text-center">
                <button (click)="openEditModal(expense.id)" class="text-blue-600 mr-2">
                  ‚úèÔ∏è
                </button>
                <button (click)="deleteExpense(expense.id)" class="text-red-600">
                  üóëÔ∏è
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </details>
  </div>

  <!-- Totales generales -->
  <div class="overflow-x-auto mt-4">
    <table class="w-full min-w-[640px] border-collapse text-sm">
      <tbody>
        <tr class="bg-blue-100 font-bold text-blue-900 border-t">
          <td class="py-3 px-2 sm:px-4 text-left">Totales Generales</td>
          <td class="py-3 px-2 sm:px-4 text-right"> Gastado:
            ${{ formatCurrency(getTotalExpenses()) }}
          </td>
          <td class="py-3 px-2 sm:px-4 text-right" > Estimado:
            ${{ formatCurrency(getTotalEstimations()) }}
          </td>
          <td></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Modal de agregar gasto -->
<div *ngIf="isModalOpen" class="fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-50">
  <div class="bg-white p-6 rounded-lg shadow-lg w-96">
    <h2 class="text-xl font-bold mb-4">Agregar Nuevo Gasto</h2>

    <label class="block mb-2">Descripci√≥n:</label>
    <input type="text" [(ngModel)]="newExpense.descripcion" placeholder="Ejm: Supermercado"
      class="w-full p-2 border rounded-md mb-3" />

    <label class="block mb-2">Categor√≠a:</label>
    <select [(ngModel)]="newExpense.categoria" class="w-full p-2 border rounded-md mb-3">
      <option *ngFor="let categoria of categorias" [value]="categoria">
        {{ categoria }}
      </option>
    </select>

    <label class="block mb-2">Valor:</label>
    <input type="text" [value]="formatCurrency(newExpense.valor)" (input)="onValueInput($event, 'valor')"
      placeholder="Ejm: 35.400" class="w-full p-2 border rounded-md mb-3" />

    <label class="block mb-2">Estimaci√≥n:</label>
    <input type="text" [value]="formatCurrency(newExpense.estimacion)" (input)="onValueInput($event, 'estimacion')"
      placeholder="Ejm: 30.000" class="w-full p-2 border rounded-md mb-3" />

    <div class="flex justify-end gap-2">
      <button (click)="closeModal()" class="px-4 py-2 border rounded-md">
        Cancelar
      </button>
      <button (click)="addExpense()" class="px-4 py-2 bg-green-500 text-white rounded-md">
        Agregar
      </button>
    </div>
  </div>
</div>

<!-- Modal de editar gasto -->
<div *ngIf="isEditModalOpen" class="fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-50">
  <div class="bg-white p-6 rounded-lg shadow-lg w-96">
    <h2 class="text-xl font-bold mb-4">Editar Gasto</h2>

    <label class="block mb-2">Descripci√≥n:</label>
    <input type="text" [(ngModel)]="editedExpense.descripcion" placeholder="Ejm: Alquiler"
      class="w-full p-2 border rounded-md mb-3" />

    <label class="block mb-2">Categor√≠a:</label>
    <select [(ngModel)]="editedExpense.categoria" class="w-full p-2 border rounded-md mb-3">
      <option *ngFor="let categoria of categorias" [value]="categoria">
        {{ categoria }}
      </option>
    </select>

    <label class="block mb-2">Valor:</label>
    <input type="text" [value]="formatCurrency(editedExpense.valor)" (input)="onEditValueInput($event, 'valor')"
      placeholder="Ejm: 50.000" class="w-full p-2 border rounded-md mb-3" />

    <label class="block mb-2">Estimaci√≥n:</label>
    <input type="text" [value]="formatCurrency(editedExpense.estimacion)"
      (input)="onEditValueInput($event, 'estimacion')" placeholder="Ejm: 48.000"
      class="w-full p-2 border rounded-md mb-3" />

    <div class="flex justify-end gap-2">
      <button (click)="closeEditModal()" class="px-4 py-2 border rounded-md">
        Cancelar
      </button>
      <button (click)="saveEditedExpense()" class="px-4 py-2 bg-green-500 text-white rounded-md">
        Guardar
      </button>
    </div>
  </div>
</div>
