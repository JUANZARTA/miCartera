"use strict";(self.webpackChunkmiCartera=self.webpackChunkmiCartera||[]).push([[146],{3146:(M,_,a)=>{a.r(_),a.d(_,{default:()=>k});var e=a(4438),i=a(177),u=a(9417),h=a(9156),c=a(1403),m=a(3062),g=a(4796),f=a(402),p=a(6672);const D=(d,s,t)=>({"bg-orange-600":d,"bg-sky-600":s,"bg-teal-600":t});function x(d,s){if(1&d){const t=e.RV6();e.j41(0,"tr",22)(1,"td",23),e.EFF(2),e.k0s(),e.j41(3,"td",24),e.EFF(4),e.k0s(),e.j41(5,"td",24),e.EFF(6),e.k0s(),e.j41(7,"td",25),e.EFF(8),e.k0s(),e.j41(9,"td",24)(10,"button",26),e.bIt("click",function(){const n=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.togglePaymentStatus(n))}),e.EFF(11),e.k0s()(),e.j41(12,"td",24)(13,"button",27),e.bIt("click",function(){const n=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.openAddModal(n.id))}),e.j41(14,"span",28),e.EFF(15,"add"),e.k0s()(),e.j41(16,"button",29),e.bIt("click",function(){const n=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.openEditModal(n.id))}),e.j41(17,"mat-icon"),e.EFF(18,"edit"),e.k0s()(),e.j41(19,"button",30),e.bIt("click",function(){const n=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.openDeleteModal(n.id))}),e.j41(20,"mat-icon"),e.EFF(21,"delete"),e.k0s()()()()}if(2&d){const t=s.$implicit,o=e.XpG();e.R7$(2),e.JRh(t.acreedor),e.R7$(2),e.JRh(t.fecha_deuda),e.R7$(2),e.JRh(t.fecha_pago),e.R7$(2),e.SpI(" $",o.formatCurrency(t.valor)," "),e.R7$(2),e.Y8G("ngClass","Pagado"===t.estado?"bg-sky-700 text-white hover:bg-slate-700":"bg-orange-600 text-white hover:bg-red-600"),e.R7$(),e.SpI(" ",t.estado," ")}}function v(d,s){if(1&d){const t=e.RV6();e.j41(0,"div",31)(1,"div",32)(2,"h2",33),e.EFF(3,"Agregar Nueva Deuda"),e.k0s(),e.j41(4,"p",34),e.EFF(5,"Introduce los detalles de la nueva deuda."),e.k0s(),e.j41(6,"label",35),e.EFF(7,"Nombre Deuda:"),e.k0s(),e.j41(8,"input",36),e.mxI("ngModelChange",function(n){e.eBV(t);const r=e.XpG();return e.DH7(r.newDebt.acreedor,n)||(r.newDebt.acreedor=n),e.Njj(n)}),e.k0s(),e.j41(9,"label",35),e.EFF(10,"Fecha de Deuda:"),e.k0s(),e.j41(11,"input",37),e.mxI("ngModelChange",function(n){e.eBV(t);const r=e.XpG();return e.DH7(r.newDebt.fecha_deuda,n)||(r.newDebt.fecha_deuda=n),e.Njj(n)}),e.k0s(),e.j41(12,"label",35),e.EFF(13,"Fecha de Pago:"),e.k0s(),e.j41(14,"input",37),e.mxI("ngModelChange",function(n){e.eBV(t);const r=e.XpG();return e.DH7(r.newDebt.fecha_pago,n)||(r.newDebt.fecha_pago=n),e.Njj(n)}),e.k0s(),e.j41(15,"label",35),e.EFF(16,"Valor:"),e.k0s(),e.j41(17,"input",38),e.bIt("input",function(n){e.eBV(t);const r=e.XpG();return e.Njj(r.onValueInput(n,"new"))}),e.k0s(),e.j41(18,"div",39)(19,"button",40),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.closeModal())}),e.EFF(20,"Cancelar"),e.k0s(),e.j41(21,"button",41),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.addDebt())}),e.EFF(22,"Agregar"),e.k0s()()()()}if(2&d){const t=e.XpG();e.R7$(8),e.R50("ngModel",t.newDebt.acreedor),e.R7$(3),e.R50("ngModel",t.newDebt.fecha_deuda),e.R7$(3),e.R50("ngModel",t.newDebt.fecha_pago),e.R7$(3),e.Y8G("value",t.formatCurrency(t.newDebt.valor))}}function j(d,s){if(1&d){const t=e.RV6();e.j41(0,"div",31)(1,"div",32)(2,"h2",33),e.EFF(3,"Editar Deuda"),e.k0s(),e.j41(4,"p",34),e.EFF(5,"Edita los detalles de la deuda."),e.k0s(),e.j41(6,"label",35),e.EFF(7,"Nombre Deuda:"),e.k0s(),e.j41(8,"input",42),e.mxI("ngModelChange",function(n){e.eBV(t);const r=e.XpG();return e.DH7(r.editedDebt.acreedor,n)||(r.editedDebt.acreedor=n),e.Njj(n)}),e.k0s(),e.j41(9,"label",35),e.EFF(10,"Fecha de Deuda:"),e.k0s(),e.j41(11,"input",37),e.mxI("ngModelChange",function(n){e.eBV(t);const r=e.XpG();return e.DH7(r.editedDebt.fecha_deuda,n)||(r.editedDebt.fecha_deuda=n),e.Njj(n)}),e.k0s(),e.j41(12,"label",35),e.EFF(13,"Fecha de Pago:"),e.k0s(),e.j41(14,"input",37),e.mxI("ngModelChange",function(n){e.eBV(t);const r=e.XpG();return e.DH7(r.editedDebt.fecha_pago,n)||(r.editedDebt.fecha_pago=n),e.Njj(n)}),e.k0s(),e.j41(15,"label",35),e.EFF(16,"Valor:"),e.k0s(),e.j41(17,"input",43),e.bIt("input",function(n){e.eBV(t);const r=e.XpG();return e.Njj(r.onValueInput(n,"edit"))}),e.k0s(),e.j41(18,"div",39)(19,"button",40),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.closeEditModal())}),e.EFF(20,"Cancelar"),e.k0s(),e.j41(21,"button",41),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.saveEditedDebt())}),e.EFF(22,"Guardar"),e.k0s()()()()}if(2&d){const t=e.XpG();e.R7$(8),e.R50("ngModel",t.editedDebt.acreedor),e.R7$(3),e.R50("ngModel",t.editedDebt.fecha_deuda),e.R7$(3),e.R50("ngModel",t.editedDebt.fecha_pago),e.R7$(3),e.Y8G("value",t.formatCurrency(t.editedDebt.valor))}}function F(d,s){if(1&d){const t=e.RV6();e.j41(0,"div",31)(1,"div",44)(2,"h2",45),e.EFF(3,"Agregar o Restar Valor"),e.k0s(),e.j41(4,"p",34),e.EFF(5,"Introduce un valor para agregar o restar a esta deuda."),e.k0s(),e.j41(6,"label",46),e.EFF(7,"Valor:"),e.k0s(),e.j41(8,"input",47),e.bIt("input",function(n){e.eBV(t);const r=e.XpG();return e.Njj(r.onValueInput(n,"add"))}),e.k0s(),e.j41(9,"div",39)(10,"button",40),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.closeAddValueModal())}),e.EFF(11,"Cancelar"),e.k0s(),e.j41(12,"button",41),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.applyValue("subtract"))}),e.EFF(13,"Restar"),e.k0s(),e.j41(14,"button",48),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.applyValue("add"))}),e.EFF(15,"Sumar"),e.k0s()()()()}if(2&d){const t=e.XpG();e.R7$(8),e.Y8G("value",t.formatCurrency(t.newValue))}}function E(d,s){if(1&d){const t=e.RV6();e.j41(0,"div",31)(1,"div",49)(2,"span",50),e.EFF(3," report_problem "),e.k0s(),e.j41(4,"h2",51),e.EFF(5,"\xbfEliminar Deuda?"),e.k0s(),e.j41(6,"p",52),e.EFF(7,"\xbfEst\xe1s seguro de que deseas eliminar esta deuda? Esta acci\xf3n no se puede deshacer. "),e.k0s(),e.j41(8,"div",53)(9,"button",54),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.closeDeleteModal())}),e.EFF(10,"Cancelar"),e.k0s(),e.j41(11,"button",55),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.confirmDeleteDebt())}),e.EFF(12," Eliminar "),e.k0s()()()()}}let k=(()=>{class d{constructor(){this.debtService=(0,e.WQX)(h.V),this.decimalPipe=(0,e.WQX)(i.QX),this.dateService=(0,e.WQX)(m.k),this.authService=(0,e.WQX)(g.u),this.finanzasService=(0,e.WQX)(f.q),this.selectedDebtId=null,this.incomes=[],this.expenses=[],this.wallet=[],this.loans=[],this.estadoFinanciero="",this.estadoFinancieroColor="verde",this.cuadreDescuadre=0,this.isDeleteModalOpen=!1,this.debtToDeleteId=null,this.isAddValueModalOpen=!1,this.newValue=0,this.debts=[],this.isModalOpen=!1,this.isEditModalOpen=!1,this.editedDebt=new c.g("","","",0,"Pendiente"),this.editedId=null,this.newDebt=new c.g("","","",0,"Pendiente"),this.userId=JSON.parse(localStorage.getItem("user")||"{}").localId,this.currentYear="",this.currentMonth=""}ngOnInit(){this.dateSubscription=this.dateService.selectedDate$.subscribe(t=>{t.year&&t.month&&(this.currentYear=t.year,this.currentMonth=t.month,this.loadDebts())}),this.finanzasService.mostrarEstadoFinanciero(this,this.userId,this.currentYear,this.currentMonth)}ngOnDestroy(){this.dateSubscription?.unsubscribe()}loadDebts(){this.debtService.getDebts(this.userId,this.currentYear,this.currentMonth).subscribe({next:t=>{this.debts=Object.entries(t).map(([n,r])=>({id:n,...r}));const o=(new Date).toISOString().split("T")[0];for(const n of this.debts)"Pendiente"===n.estado&&(n.fecha_pago===o&&this.authService.addNotification(this.userId,`Tienes una deuda que vence hoy con ${n.acreedor}`,`deuda_vence_hoy_${n.id}`).subscribe(),new Date(n.fecha_pago)<new Date(o)&&this.authService.addNotification(this.userId,`Tienes una deuda vencida con ${n.acreedor}`,`deuda_vencida_${n.id}`).subscribe())},error:t=>{console.error("Error al cargar deudas:",t)}})}openModal(){this.isModalOpen=!0}closeModal(){this.isModalOpen=!1,this.newDebt=new c.g("","","",0,"Pendiente")}addDebt(){this.newDebt.acreedor&&this.newDebt.fecha_deuda&&this.newDebt.fecha_pago&&!(this.newDebt.valor<=0)?this.debtService.addDebt(this.userId,this.currentYear,this.currentMonth,{...this.newDebt}).subscribe({next:()=>{this.loadDebts(),this.closeModal()}}):alert("Por favor completa todos los campos.")}openAddModal(t){this.selectedDebtId=t,this.isAddValueModalOpen=!0}closeAddValueModal(){this.isAddValueModalOpen=!1,this.newValue=0}saveNewValue(){if(!this.selectedDebtId)return;const t=this.debts.find(r=>r.id===this.selectedDebtId);t&&this.debtService.updateDebt(this.userId,this.currentYear,this.currentMonth,t.id,{acreedor:t.acreedor,fecha_deuda:t.fecha_deuda,fecha_pago:t.fecha_pago,valor:t.valor+this.newValue,estado:t.estado}).subscribe({next:()=>{this.loadDebts(),this.closeAddValueModal()},error:r=>{console.error("Error al actualizar valor de deuda:",r)}})}openEditModal(t){const o=this.debts.find(n=>n.id===t);o&&(this.editedDebt=new c.g(o.acreedor,o.fecha_deuda,o.fecha_pago,o.valor,o.estado),this.editedId=t,this.isEditModalOpen=!0)}closeEditModal(){this.isEditModalOpen=!1,this.editedDebt=new c.g("","","",0,"Pendiente"),this.editedId=null}saveEditedDebt(){this.editedId&&this.debtService.updateDebt(this.userId,this.currentYear,this.currentMonth,this.editedId,this.editedDebt).subscribe({next:()=>{this.loadDebts(),this.closeEditModal()},error:t=>{console.error("Error al actualizar deuda:",t)}})}deleteDebt(t){confirm("\xbfEst\xe1s seguro de eliminar esta deuda?")&&this.debtService.deleteDebt(this.userId,this.currentYear,this.currentMonth,t).subscribe({next:()=>{this.loadDebts()},error:n=>{console.error("Error al eliminar deuda:",n)}})}openDeleteModal(t){this.isDeleteModalOpen=!0,this.debtToDeleteId=t}confirmDeleteDebt(){this.debtToDeleteId&&this.debtService.deleteDebt(this.userId,this.currentYear,this.currentMonth,this.debtToDeleteId).subscribe({next:()=>{this.loadDebts(),this.closeDeleteModal()},error:t=>{console.error("Error al eliminar deuda:",t)}})}closeDeleteModal(){this.isDeleteModalOpen=!1,this.debtToDeleteId=null}togglePaymentStatus(t){const o="Pendiente"===t.estado?"Pagado":"Pendiente";this.debtService.updateDebt(this.userId,this.currentYear,this.currentMonth,t.id,{acreedor:t.acreedor,fecha_deuda:t.fecha_deuda,fecha_pago:t.fecha_pago,valor:t.valor,estado:o}).subscribe({next:()=>{this.loadDebts(),"Pagado"===o&&this.authService.addNotification(this.userId,`Pagaste tu deuda con ${t.acreedor} correctamente`).subscribe()},error:r=>{console.error("Error al cambiar estado de la deuda:",r)}})}getTotalPendingDebts(){return this.debts.filter(t=>"Pendiente"===t.estado).reduce((t,o)=>t+Number(o.valor),0)}formatCurrency(t){return this.decimalPipe.transform(t,"1.0-0")||""}onValueInput(t,o){const n=t.target,r=n.value.replace(/[^\d-]/g,""),l=Number(r)||null;"new"===o?this.newDebt.valor=l??0:"edit"===o?this.editedDebt.valor=l??0:"add"===o&&(this.newValue=l??0),n.value=this.formatCurrency(l??0)}applyValue(t){if(!this.selectedDebtId)return;const o=this.debts.find(b=>b.id===this.selectedDebtId);if(!o)return;let n=this.newValue;n="subtract"===t?-Math.abs(this.newValue):Math.abs(this.newValue),this.debtService.updateDebt(this.userId,this.currentYear,this.currentMonth,o.id,{acreedor:o.acreedor,fecha_deuda:o.fecha_deuda,fecha_pago:o.fecha_pago,valor:o.valor+n,estado:o.estado}).subscribe({next:()=>{this.loadDebts(),this.closeAddValueModal()},error:b=>{console.error("Error al actualizar deuda:",b)}})}static{this.\u0275fac=function(o){return new(o||d)}}static{this.\u0275cmp=e.VBU({type:d,selectors:[["app-debts"]],standalone:!0,features:[e.Jv_([i.QX]),e.aNF],decls:46,vars:12,consts:[[1,"mb-6","grid","grid-cols-1","xl:grid-cols-2","gap-6"],[1,"relative","flex","flex-col","bg-white","rounded-xl","shadow-lg","overflow-hidden","xl:col-span-2","border","border-gray-200"],[1,"px-6","py-4","border-b","flex","center-end"],[1,"text-white","text-sm","font-semibold","px-4","py-2","rounded-full","shadow-md",3,"ngClass"],[1,"flex","items-center","justify-between","p-6","bg-sky-800","text-white","rounded-t-xl","shadow-md"],[1,"text-xl","font-bold","tracking-wide"],[1,"text-sm","flex","items-center","gap-2","opacity-90"],[1,"overflow-x-auto"],[1,"w-full","min-w-[640px]","border-collapse"],[1,"bg-gray-100"],[1,"border-b"],[1,"py-4","px-6","text-left","text-xs","font-semibold","uppercase","text-gray-600"],[1,"py-4","px-6","text-center","text-xs","font-semibold","uppercase","text-gray-600"],[1,"py-4","px-6","text-right","text-xs","font-semibold","uppercase","text-gray-600"],["class","border-b transition duration-300 hover:bg-gray-50",4,"ngFor","ngForOf"],[1,"bg-teal-50","font-bold","text-sky-900"],[1,"py-4","px-6","text-left"],[1,"py-4","px-6"],[1,"py-4","px-6","text-right"],[1,"flex","justify-end","p-4"],[1,"bg-sky-700","text-white","px-4","py-2","rounded-md","shadow-md","hover:bg-slate-700","transition",3,"click"],["class","fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-50",4,"ngIf"],[1,"border-b","transition","duration-300","hover:bg-gray-50"],[1,"py-4","px-6","font-semibold"],[1,"py-4","px-6","text-center"],[1,"py-4","px-6","text-right","font-semibold","text-cyan-600"],[1,"px-3","py-1","text-xs","font-semibold","rounded-full","transition","duration-300",3,"click","ngClass"],[1,"text-lime-600","mr-2",3,"click"],[1,"material-icons"],[1,"text-sky-700","mr-2",3,"click"],[1,"text-orange-600",3,"click"],[1,"fixed","inset-0","flex","items-center","justify-center","bg-gray-900","bg-opacity-50"],[1,"bg-white","p-6","rounded-lg","shadow-lg","w-96"],[1,"text-xl","font-bold","mb-4"],[1,"text-gray-600","mb-4","text-sm"],[1,"block","mb-2"],["type","text","placeholder","Ejm: Banco Pichincha",1,"w-full","p-2","border","rounded-md","mb-3",3,"ngModelChange","ngModel"],["type","date",1,"w-full","p-2","border","rounded-md","mb-3",3,"ngModelChange","ngModel"],["type","text","placeholder","Ejm: 35.000",1,"w-full","p-2","border","rounded-md","mb-3",3,"input","value"],[1,"flex","justify-end","gap-2"],[1,"px-4","py-2","border","rounded-md","bg-white-700","hover:bg-slate-200",3,"click"],[1,"px-4","py-2","bg-sky-700","text-white","rounded-md","hover:bg-slate-700",3,"click"],["type","text","placeholder","Ejm: Tarjeta Visa",1,"w-full","p-2","border","rounded-md","mb-3",3,"ngModelChange","ngModel"],["type","text","placeholder","Ejm: 50.000",1,"w-full","p-2","border","rounded-md","mb-3",3,"input","value"],[1,"bg-white","p-6","rounded-lg","shadow-lg","w-80"],[1,"text-xl","font-bold","mb-2"],[1,"block","mb-2","font-semibold"],["type","text","placeholder","Ej: 2000",1,"w-full","p-2","border","rounded-md","mb-4",3,"input","value"],[1,"px-4","py-2","bg-teal-700","text-white","rounded-md","hover:bg-emerald-800",3,"click"],[1,"bg-white","p-6","rounded-lg","shadow-lg","w-80","text-center"],[1,"material-icons","text-red-600","mx-auto","mb-4",2,"font-size","48px"],[1,"text-xl","font-bold","mt-4","mb-2"],[1,"mb-6","text-gray-700"],[1,"flex","justify-center","gap-2"],[1,"px-4","py-2","border","rounded-md","bg-white-700","hover:bg-orange-200",3,"click"],[1,"px-4","py-2","bg-orange-600","text-white","rounded-md","hover:bg-red-600",3,"click"]],template:function(o,n){1&o&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),e.EFF(4),e.k0s()(),e.j41(5,"div",4)(6,"div")(7,"h6",5),e.EFF(8,"Deudas"),e.k0s(),e.j41(9,"p",6)(10,"strong"),e.EFF(11,"Estado de Deudas"),e.k0s()()()(),e.j41(12,"div",7)(13,"table",8)(14,"thead",9)(15,"tr",10)(16,"th",11),e.EFF(17,"Nombre Deuda"),e.k0s(),e.j41(18,"th",12),e.EFF(19,"Fecha de Deuda"),e.k0s(),e.j41(20,"th",12),e.EFF(21,"Fecha de Pago"),e.k0s(),e.j41(22,"th",13),e.EFF(23,"Valor"),e.k0s(),e.j41(24,"th",12),e.EFF(25,"Estado"),e.k0s(),e.j41(26,"th",12),e.EFF(27,"Acciones"),e.k0s()()(),e.j41(28,"tbody"),e.DNE(29,x,22,6,"tr",14),e.j41(30,"tr",15)(31,"td",16),e.EFF(32,"Total Deudas Pendientes"),e.k0s(),e.nrm(33,"td",17)(34,"td",17),e.j41(35,"td",18),e.EFF(36),e.k0s(),e.nrm(37,"td",17)(38,"td"),e.k0s()()()(),e.j41(39,"div",19)(40,"button",20),e.bIt("click",function(){return n.openModal()}),e.EFF(41," Agregar Deuda + "),e.k0s()(),e.DNE(42,v,23,4,"div",21)(43,j,23,4,"div",21)(44,F,16,1,"div",21)(45,E,13,0,"div",21),e.k0s()()),2&o&&(e.R7$(3),e.Y8G("ngClass",e.sMw(8,D,"rojo"===n.estadoFinancieroColor,"azul"===n.estadoFinancieroColor,"verde"===n.estadoFinancieroColor)),e.R7$(),e.SpI(" ",n.estadoFinanciero," "),e.R7$(25),e.Y8G("ngForOf",n.debts),e.R7$(7),e.SpI(" $",n.formatCurrency(n.getTotalPendingDebts())," "),e.R7$(6),e.Y8G("ngIf",n.isModalOpen),e.R7$(),e.Y8G("ngIf",n.isEditModalOpen),e.R7$(),e.Y8G("ngIf",n.isAddValueModalOpen),e.R7$(),e.Y8G("ngIf",n.isDeleteModalOpen))},dependencies:[i.MD,i.YU,i.Sq,i.bT,u.YN,u.me,u.BC,u.vS,p.m_,p.An]})}}return d})()}}]);