"use strict";(self.webpackChunkmiCartera=self.webpackChunkmiCartera||[]).push([[780],{2780:(j,p,s)=>{s.r(p),s.d(p,{default:()=>x});var e=s(4438),i=s(177),c=s(9417),h=s(2757);class d{constructor(l,t,o,n,a){this.deudor=l,this.fecha_prestamo=t,this.fecha_pago=o,this.valor=n,this.estado=a}}var m=s(3062),_=s(4796);function g(r,l){if(1&r){const t=e.RV6();e.j41(0,"tr",20)(1,"td",21),e.EFF(2),e.k0s(),e.j41(3,"td",22),e.EFF(4),e.k0s(),e.j41(5,"td",22),e.EFF(6),e.k0s(),e.j41(7,"td",23),e.EFF(8),e.k0s(),e.j41(9,"td",22)(10,"button",24),e.bIt("click",function(){const n=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.togglePaymentStatus(n))}),e.EFF(11),e.k0s()(),e.j41(12,"td",22)(13,"button",25),e.bIt("click",function(){const n=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.openEditModal(n.id))}),e.EFF(14,"\u270f\ufe0f"),e.k0s(),e.j41(15,"button",26),e.bIt("click",function(){const n=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.deleteLoan(n.id))}),e.EFF(16,"\u{1f5d1}\ufe0f"),e.k0s()()()}if(2&r){const t=l.$implicit,o=e.XpG();e.R7$(2),e.JRh(t.deudor),e.R7$(2),e.JRh(t.fecha_prestamo),e.R7$(2),e.JRh(t.fecha_pago),e.R7$(2),e.SpI(" $",o.formatCurrency(t.valor)," "),e.R7$(2),e.Y8G("ngClass","Pagado"===t.estado?"bg-green-500 text-white hover:bg-green-600":"bg-red-500 text-white hover:bg-red-600"),e.R7$(),e.SpI(" ",t.estado," ")}}function f(r,l){if(1&r){const t=e.RV6();e.j41(0,"div",27)(1,"div",28)(2,"h2",29),e.EFF(3,"Agregar Nuevo Pr\xe9stamo"),e.k0s(),e.j41(4,"label",30),e.EFF(5,"Nombre Deudor:"),e.k0s(),e.j41(6,"input",31),e.mxI("ngModelChange",function(n){e.eBV(t);const a=e.XpG();return e.DH7(a.newLoan.deudor,n)||(a.newLoan.deudor=n),e.Njj(n)}),e.k0s(),e.j41(7,"label",30),e.EFF(8,"Fecha de Pr\xe9stamo:"),e.k0s(),e.j41(9,"input",32),e.mxI("ngModelChange",function(n){e.eBV(t);const a=e.XpG();return e.DH7(a.newLoan.fecha_prestamo,n)||(a.newLoan.fecha_prestamo=n),e.Njj(n)}),e.k0s(),e.j41(10,"label",30),e.EFF(11,"Fecha de Pago:"),e.k0s(),e.j41(12,"input",32),e.mxI("ngModelChange",function(n){e.eBV(t);const a=e.XpG();return e.DH7(a.newLoan.fecha_pago,n)||(a.newLoan.fecha_pago=n),e.Njj(n)}),e.k0s(),e.j41(13,"label",30),e.EFF(14,"Valor:"),e.k0s(),e.j41(15,"input",33),e.bIt("input",function(n){e.eBV(t);const a=e.XpG();return e.Njj(a.onValueInput(n,"new"))}),e.k0s(),e.j41(16,"div",34)(17,"button",35),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.closeModal())}),e.EFF(18,"Cancelar"),e.k0s(),e.j41(19,"button",36),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.addLoan())}),e.EFF(20,"Agregar"),e.k0s()()()()}if(2&r){const t=e.XpG();e.R7$(6),e.R50("ngModel",t.newLoan.deudor),e.R7$(3),e.R50("ngModel",t.newLoan.fecha_prestamo),e.R7$(3),e.R50("ngModel",t.newLoan.fecha_pago),e.R7$(3),e.Y8G("value",t.formatCurrency(t.newLoan.valor))}}function b(r,l){if(1&r){const t=e.RV6();e.j41(0,"div",27)(1,"div",28)(2,"h2",29),e.EFF(3,"Editar Pr\xe9stamo"),e.k0s(),e.j41(4,"label",30),e.EFF(5,"Nombre Deudor:"),e.k0s(),e.j41(6,"input",31),e.mxI("ngModelChange",function(n){e.eBV(t);const a=e.XpG();return e.DH7(a.editedLoan.deudor,n)||(a.editedLoan.deudor=n),e.Njj(n)}),e.k0s(),e.j41(7,"label",30),e.EFF(8,"Fecha de Pr\xe9stamo:"),e.k0s(),e.j41(9,"input",32),e.mxI("ngModelChange",function(n){e.eBV(t);const a=e.XpG();return e.DH7(a.editedLoan.fecha_prestamo,n)||(a.editedLoan.fecha_prestamo=n),e.Njj(n)}),e.k0s(),e.j41(10,"label",30),e.EFF(11,"Fecha de Pago:"),e.k0s(),e.j41(12,"input",32),e.mxI("ngModelChange",function(n){e.eBV(t);const a=e.XpG();return e.DH7(a.editedLoan.fecha_pago,n)||(a.editedLoan.fecha_pago=n),e.Njj(n)}),e.k0s(),e.j41(13,"label",30),e.EFF(14,"Valor:"),e.k0s(),e.j41(15,"input",37),e.bIt("input",function(n){e.eBV(t);const a=e.XpG();return e.Njj(a.onValueInput(n,"edit"))}),e.k0s(),e.j41(16,"div",34)(17,"button",35),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.closeEditModal())}),e.EFF(18,"Cancelar"),e.k0s(),e.j41(19,"button",36),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.saveEditedLoan())}),e.EFF(20,"Guardar"),e.k0s()()()()}if(2&r){const t=e.XpG();e.R7$(6),e.R50("ngModel",t.editedLoan.deudor),e.R7$(3),e.R50("ngModel",t.editedLoan.fecha_prestamo),e.R7$(3),e.R50("ngModel",t.editedLoan.fecha_pago),e.R7$(3),e.Y8G("value",t.formatCurrency(t.editedLoan.valor))}}let x=(()=>{class r{constructor(){this.loanService=(0,e.WQX)(h.a),this.decimalPipe=(0,e.WQX)(i.QX),this.dateService=(0,e.WQX)(m.k),this.authService=(0,e.WQX)(_.u),this.loans=[],this.isModalOpen=!1,this.isEditModalOpen=!1,this.editedLoan=new d("","","",0,"Pendiente"),this.editedId=null,this.newLoan=new d("","","",0,"Pendiente"),this.userId=JSON.parse(localStorage.getItem("user")||"{}").localId,this.currentYear="",this.currentMonth=""}ngOnInit(){this.dateSubscription=this.dateService.selectedDate$.subscribe(t=>{t.year&&t.month&&(this.currentYear=t.year,this.currentMonth=t.month,this.loadLoans())})}ngOnDestroy(){this.dateSubscription?.unsubscribe()}loadLoans(){this.loanService.getLoans(this.userId,this.currentYear,this.currentMonth).subscribe({next:t=>{this.loans=Object.entries(t).map(([n,a])=>({id:n,...a}));const o=(new Date).toISOString().split("T")[0];for(const n of this.loans)"Pendiente"===n.estado&&(new Date(n.fecha_pago)<new Date(o)&&this.authService.addNotification(this.userId,`Venci\xf3 el pr\xe9stamo a ${n.deudor}`).subscribe(),this.authService.addNotification(this.userId,`Record\xe1 que ${n.deudor} te debe $${n.valor}`).subscribe())},error:t=>{console.error("Error al cargar pr\xe9stamos:",t)}})}openModal(){this.isModalOpen=!0}closeModal(){this.isModalOpen=!1,this.newLoan=new d("","","",0,"Pendiente")}addLoan(){this.newLoan.deudor&&this.newLoan.fecha_prestamo&&this.newLoan.fecha_pago&&!(this.newLoan.valor<=0)?this.loanService.addLoan(this.userId,this.currentYear,this.currentMonth,this.newLoan).subscribe({next:()=>{this.loadLoans(),this.closeModal()}}):alert("Por favor completa todos los campos.")}openEditModal(t){const o=this.loans.find(n=>n.id===t);o&&(this.editedLoan=new d(o.deudor,o.fecha_prestamo,o.fecha_pago,o.valor,o.estado),this.editedId=t,this.isEditModalOpen=!0)}closeEditModal(){this.isEditModalOpen=!1,this.editedLoan=new d("","","",0,"Pendiente"),this.editedId=null}saveEditedLoan(){this.editedId&&this.loanService.updateLoan(this.userId,this.currentYear,this.currentMonth,this.editedId,this.editedLoan).subscribe({next:()=>{this.loadLoans(),this.closeEditModal()},error:t=>{console.error("Error al actualizar pr\xe9stamo:",t)}})}deleteLoan(t){confirm("\xbfEst\xe1s seguro de eliminar este pr\xe9stamo?")&&this.loanService.deleteLoan(this.userId,this.currentYear,this.currentMonth,t).subscribe({next:()=>{this.loadLoans()},error:n=>{console.error("Error al eliminar pr\xe9stamo:",n)}})}togglePaymentStatus(t){this.loanService.updateLoan(this.userId,this.currentYear,this.currentMonth,t.id,{deudor:t.deudor,fecha_prestamo:t.fecha_prestamo,fecha_pago:t.fecha_pago,valor:t.valor,estado:"Pendiente"===t.estado?"Pagado":"Pendiente"}).subscribe({next:()=>{this.loadLoans()},error:a=>{console.error("Error al actualizar estado del pr\xe9stamo:",a)}})}getTotalPendingLoans(){return this.loans.filter(t=>"Pendiente"===t.estado).reduce((t,o)=>t+Number(o.valor),0)}formatCurrency(t){return this.decimalPipe.transform(t,"1.0-0")||""}onValueInput(t,o){const n=t.target,a=n.value.replace(/[.,]/g,""),u=Number(a)||null;"new"===o?this.newLoan.valor=u??0:this.editedLoan.valor=u??0,n.value=this.formatCurrency(u??0)}static{this.\u0275fac=function(o){return new(o||r)}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-loans"]],standalone:!0,features:[e.Jv_([i.QX]),e.aNF],decls:41,vars:4,consts:[[1,"mb-6","grid","grid-cols-1","xl:grid-cols-2","gap-6"],[1,"relative","flex","flex-col","bg-white","rounded-xl","shadow-lg","overflow-hidden","xl:col-span-2","border","border-gray-200"],[1,"flex","items-center","justify-between","p-6","bg-gradient-to-r","from-blue-700","to-teal-500","text-white","rounded-t-xl","shadow-md"],[1,"text-xl","font-bold","tracking-wide"],[1,"text-sm","flex","items-center","gap-2","opacity-90"],[1,"overflow-x-auto"],[1,"w-full","min-w-[640px]","border-collapse"],[1,"bg-gray-100"],[1,"border-b"],[1,"py-4","px-6","text-left","text-xs","font-semibold","uppercase","text-gray-600"],[1,"py-4","px-6","text-center","text-xs","font-semibold","uppercase","text-gray-600"],[1,"py-4","px-6","text-right","text-xs","font-semibold","uppercase","text-gray-600"],["class","border-b transition duration-300 hover:bg-gray-50",4,"ngFor","ngForOf"],[1,"bg-teal-50","font-bold","text-teal-900"],[1,"py-4","px-6","text-left"],[1,"py-4","px-6"],[1,"py-4","px-6","text-right"],[1,"flex","justify-end","p-4"],[1,"bg-blue-600","text-white","px-4","py-2","rounded-md","shadow-md","hover:bg-teal-500","transition",3,"click"],["class","fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-50",4,"ngIf"],[1,"border-b","transition","duration-300","hover:bg-gray-50"],[1,"py-4","px-6","font-semibold"],[1,"py-4","px-6","text-center"],[1,"py-4","px-6","text-right","font-semibold","text-teal-600"],[1,"px-3","py-1","text-xs","font-semibold","rounded-full","transition","duration-300",3,"click","ngClass"],[1,"text-blue-600","mr-2",3,"click"],[1,"text-red-600",3,"click"],[1,"fixed","inset-0","flex","items-center","justify-center","bg-gray-900","bg-opacity-50"],[1,"bg-white","p-6","rounded-lg","shadow-lg","w-96"],[1,"text-xl","font-bold","mb-4"],[1,"block","mb-2"],["type","text","placeholder","Ejm: Juan P\xe9rez",1,"w-full","p-2","border","rounded-md","mb-3",3,"ngModelChange","ngModel"],["type","date",1,"w-full","p-2","border","rounded-md","mb-3",3,"ngModelChange","ngModel"],["type","text","placeholder","Ejm: 250.000",1,"w-full","p-2","border","rounded-md","mb-3",3,"input","value"],[1,"flex","justify-end","gap-2"],[1,"px-4","py-2","border","rounded-md",3,"click"],[1,"px-4","py-2","bg-green-500","text-white","rounded-md",3,"click"],["type","text","placeholder","Ejm: 350.000",1,"w-full","p-2","border","rounded-md","mb-3",3,"input","value"]],template:function(o,n){1&o&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"h6",3),e.EFF(5,"Pr\xe9stamos"),e.k0s(),e.j41(6,"p",4)(7,"strong"),e.EFF(8,"Estado de Pr\xe9stamos"),e.k0s()()()(),e.j41(9,"div",5)(10,"table",6)(11,"thead",7)(12,"tr",8)(13,"th",9),e.EFF(14,"Nombre Deudor"),e.k0s(),e.j41(15,"th",10),e.EFF(16,"Fecha de Pr\xe9stamo"),e.k0s(),e.j41(17,"th",10),e.EFF(18,"Fecha de Pago"),e.k0s(),e.j41(19,"th",11),e.EFF(20,"Valor"),e.k0s(),e.j41(21,"th",10),e.EFF(22,"Estado"),e.k0s(),e.j41(23,"th",10),e.EFF(24,"Acciones"),e.k0s()()(),e.j41(25,"tbody"),e.DNE(26,g,17,6,"tr",12),e.j41(27,"tr",13)(28,"td",14),e.EFF(29,"Total Pr\xe9stamos Pendientes"),e.k0s(),e.nrm(30,"td",15)(31,"td",15),e.j41(32,"td",16),e.EFF(33),e.k0s(),e.nrm(34,"td",15)(35,"td"),e.k0s()()()(),e.j41(36,"div",17)(37,"button",18),e.bIt("click",function(){return n.openModal()}),e.EFF(38," Agregar Pr\xe9stamo + "),e.k0s()(),e.DNE(39,f,21,4,"div",19)(40,b,21,4,"div",19),e.k0s()()),2&o&&(e.R7$(26),e.Y8G("ngForOf",n.loans),e.R7$(7),e.SpI(" $",n.formatCurrency(n.getTotalPendingLoans())," "),e.R7$(6),e.Y8G("ngIf",n.isModalOpen),e.R7$(),e.Y8G("ngIf",n.isEditModalOpen))},dependencies:[i.MD,i.YU,i.Sq,i.bT,c.YN,c.me,c.BC,c.vS]})}}return r})()}}]);