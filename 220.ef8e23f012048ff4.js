"use strict";(self.webpackChunkmiCartera=self.webpackChunkmiCartera||[]).push([[220],{4220:(k,v,a)=>{a.r(v),a.d(v,{default:()=>F});var t=a(4438),l=a(177),p=a(9417),h=a(7673),m=a(6354),g=a(9437),f=a(1626);let b=(()=>{class o{constructor(e){this.http=e,this.FIREBASE_BASE_URL="https://micartera-acd5b-default-rtdb.firebaseio.com"}getSavings(e,n,r){return this.http.get(`${this.FIREBASE_BASE_URL}/${e}/${n}/${r}/ahorros.json`).pipe((0,m.T)(s=>s||{}),(0,g.W)(s=>(console.error("[GET] Error al obtener ahorros:",s),(0,h.of)({}))))}addSaving(e,n,r,i){return this.http.post(`${this.FIREBASE_BASE_URL}/${e}/${n}/${r}/ahorros.json`,i).pipe((0,g.W)(u=>(console.error("[POST] Error al agregar ahorro:",u),(0,h.of)(null))))}updateSaving(e,n,r,i,s){return this.http.put(`${this.FIREBASE_BASE_URL}/${e}/${n}/${r}/ahorros/${i}.json`,s).pipe((0,g.W)(y=>(console.error("[PUT] Error al actualizar ahorro:",y),(0,h.of)(null))))}deleteSaving(e,n,r,i){return this.http.delete(`${this.FIREBASE_BASE_URL}/${e}/${n}/${r}/ahorros/${i}.json`).pipe((0,g.W)(u=>(console.error("[DELETE] Error al eliminar ahorro:",u),(0,h.of)(null))))}static{this.\u0275fac=function(n){return new(n||o)(t.KVO(f.Qq))}}static{this.\u0275prov=t.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();class d{constructor(c,e){this.tipo=c,this.valor=e}}var S=a(3062),x=a(4796);function E(o,c){if(1&o){const e=t.RV6();t.j41(0,"tr",19)(1,"td",20),t.EFF(2),t.k0s(),t.j41(3,"td",21),t.EFF(4),t.k0s(),t.j41(5,"td",22)(6,"button",23),t.bIt("click",function(){const r=t.eBV(e).$implicit,i=t.XpG();return t.Njj(i.openEditModal(r.id))}),t.EFF(7,"\u270f\ufe0f"),t.k0s(),t.j41(8,"button",24),t.bIt("click",function(){const r=t.eBV(e).$implicit,i=t.XpG();return t.Njj(i.deleteSaving(r.id))}),t.EFF(9,"\u{1f5d1}\ufe0f"),t.k0s()()()}if(2&o){const e=c.$implicit,n=t.XpG();t.R7$(2),t.JRh(e.tipo),t.R7$(2),t.SpI(" $",n.formatCurrency(e.valor)," ")}}function _(o,c){if(1&o){const e=t.RV6();t.j41(0,"div",25)(1,"div",26)(2,"h2",27),t.EFF(3,"Agregar Nuevo Ahorro"),t.k0s(),t.j41(4,"label",28),t.EFF(5,"Ahorro en:"),t.k0s(),t.j41(6,"input",29),t.mxI("ngModelChange",function(r){t.eBV(e);const i=t.XpG();return t.DH7(i.newSaving.tipo,r)||(i.newSaving.tipo=r),t.Njj(r)}),t.k0s(),t.j41(7,"label",28),t.EFF(8,"Valor:"),t.k0s(),t.j41(9,"input",30),t.bIt("input",function(r){t.eBV(e);const i=t.XpG();return t.Njj(i.onValueInput(r,"new"))}),t.k0s(),t.j41(10,"div",31)(11,"button",32),t.bIt("click",function(){t.eBV(e);const r=t.XpG();return t.Njj(r.closeModal())}),t.EFF(12,"Cancelar"),t.k0s(),t.j41(13,"button",33),t.bIt("click",function(){t.eBV(e);const r=t.XpG();return t.Njj(r.addSaving())}),t.EFF(14,"Agregar"),t.k0s()()()()}if(2&o){const e=t.XpG();t.R7$(6),t.R50("ngModel",e.newSaving.tipo),t.R7$(3),t.Y8G("value",e.formatCurrency(e.newSaving.valor))}}function j(o,c){if(1&o){const e=t.RV6();t.j41(0,"div",25)(1,"div",26)(2,"h2",27),t.EFF(3,"Editar Ahorro"),t.k0s(),t.j41(4,"label",28),t.EFF(5,"Ahorro en:"),t.k0s(),t.j41(6,"input",34),t.mxI("ngModelChange",function(r){t.eBV(e);const i=t.XpG();return t.DH7(i.editedSaving.tipo,r)||(i.editedSaving.tipo=r),t.Njj(r)}),t.k0s(),t.j41(7,"label",28),t.EFF(8,"Valor:"),t.k0s(),t.j41(9,"input",35),t.bIt("input",function(r){t.eBV(e);const i=t.XpG();return t.Njj(i.onValueInput(r,"edit"))}),t.k0s(),t.j41(10,"div",31)(11,"button",32),t.bIt("click",function(){t.eBV(e);const r=t.XpG();return t.Njj(r.closeEditModal())}),t.EFF(12,"Cancelar"),t.k0s(),t.j41(13,"button",33),t.bIt("click",function(){t.eBV(e);const r=t.XpG();return t.Njj(r.saveEditedSaving())}),t.EFF(14,"Guardar"),t.k0s()()()()}if(2&o){const e=t.XpG();t.R7$(6),t.R50("ngModel",e.editedSaving.tipo),t.R7$(3),t.Y8G("value",e.formatCurrency(e.editedSaving.valor))}}let F=(()=>{class o{constructor(){this.savingsService=(0,t.WQX)(b),this.decimalPipe=(0,t.WQX)(l.QX),this.dateService=(0,t.WQX)(S.k),this.authService=(0,t.WQX)(x.u),this.savings=[],this.isModalOpen=!1,this.isEditModalOpen=!1,this.newSaving=new d("",0),this.editedSaving=new d("",0),this.editedId=null,this.userId=JSON.parse(localStorage.getItem("user")||"{}").localId,this.currentYear="",this.currentMonth=""}ngOnInit(){this.dateSubscription=this.dateService.selectedDate$.subscribe(e=>{e.year&&e.month&&(this.currentYear=e.year,this.currentMonth=e.month,this.loadSavings())})}ngOnDestroy(){this.dateSubscription?.unsubscribe()}loadSavings(){this.savingsService.getSavings(this.userId,this.currentYear,this.currentMonth).subscribe({next:e=>{this.savings=Object.entries(e).map(([n,r])=>({id:n,...r})),0===this.savings.length&&this.authService.addNotification(this.userId,"No has ahorrado este mes").subscribe()},error:e=>{console.error("Error al cargar ahorros:",e)}})}openModal(){this.isModalOpen=!0}closeModal(){this.isModalOpen=!1,this.newSaving=new d("",0)}addSaving(){this.newSaving.tipo?this.savingsService.addSaving(this.userId,this.currentYear,this.currentMonth,this.newSaving).subscribe({next:()=>{this.loadSavings(),this.closeModal(),this.authService.addNotification(this.userId,"Has agregado dinero a tus ahorros").subscribe()}}):alert("Por favor completa todos los campos.")}openEditModal(e){const n=this.savings.find(r=>r.id===e);n&&(this.editedSaving=new d(n.tipo,n.valor),this.editedId=e,this.isEditModalOpen=!0)}closeEditModal(){this.isEditModalOpen=!1,this.editedSaving=new d("",0),this.editedId=null}saveEditedSaving(){this.editedId&&this.savingsService.updateSaving(this.userId,this.currentYear,this.currentMonth,this.editedId,this.editedSaving).subscribe({next:()=>{this.loadSavings(),this.closeEditModal()},error:e=>{console.error("Error al actualizar ahorro:",e)}})}deleteSaving(e){confirm("\xbfEst\xe1s seguro de eliminar este ahorro?")&&this.savingsService.deleteSaving(this.userId,this.currentYear,this.currentMonth,e).subscribe({next:()=>{this.loadSavings()},error:r=>{console.error("Error al eliminar ahorro:",r)}})}getTotalSavings(){return this.savings.reduce((e,n)=>e+Number(n.valor),0)}formatCurrency(e){return this.decimalPipe.transform(e,"1.0-0")||""}onValueInput(e,n){const r=e.target,i=r.value.replace(/[.,]/g,""),s=Number(i)||null;"new"===n?this.newSaving.valor=s??0:this.editedSaving.valor=s??0,r.value=this.formatCurrency(s??0)}static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-savings"]],standalone:!0,features:[t.Jv_([l.QX]),t.aNF],decls:32,vars:4,consts:[[1,"mb-6","grid","grid-cols-1","xl:grid-cols-2","gap-6"],[1,"relative","flex","flex-col","bg-white","rounded-xl","shadow-lg","overflow-hidden","xl:col-span-2","border","border-gray-200"],[1,"flex","items-center","justify-between","p-6","bg-gradient-to-r","from-blue-700","to-teal-500","text-white","rounded-t-xl","shadow-md"],[1,"text-xl","font-bold","tracking-wide"],[1,"text-sm","flex","items-center","gap-2","opacity-90"],[1,"overflow-x-auto"],[1,"w-full","min-w-[640px]","border-collapse"],[1,"bg-gray-100"],[1,"border-b"],[1,"py-4","px-6","text-left","text-xs","font-semibold","uppercase","text-gray-600"],[1,"py-4","px-6","text-right","text-xs","font-semibold","uppercase","text-gray-600"],[1,"py-4","px-6","text-center","text-xs","font-semibold","uppercase","text-gray-600"],["class","border-b transition duration-300 hover:bg-gray-50",4,"ngFor","ngForOf"],[1,"bg-teal-50","font-bold","text-teal-900"],[1,"py-4","px-6","text-left"],[1,"py-4","px-6","text-right"],[1,"flex","justify-end","p-4"],[1,"bg-blue-600","text-white","px-4","py-2","rounded-md","shadow-md","hover:bg-teal-500","transition",3,"click"],["class","fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-50",4,"ngIf"],[1,"border-b","transition","duration-300","hover:bg-gray-50"],[1,"py-4","px-6","font-semibold"],[1,"py-4","px-6","text-right","font-semibold","text-teal-700"],[1,"py-4","px-6","text-center"],[1,"text-blue-600","mr-2",3,"click"],[1,"text-red-600",3,"click"],[1,"fixed","inset-0","flex","items-center","justify-center","bg-gray-900","bg-opacity-50"],[1,"bg-white","p-6","rounded-lg","shadow-lg","w-96"],[1,"text-xl","font-bold","mb-4"],[1,"block","mb-2"],["type","text","placeholder","Ejm: Cuenta bancaria",1,"w-full","p-2","border","rounded-md","mb-3",3,"ngModelChange","ngModel"],["type","text","placeholder","Ejm: 500.000",1,"w-full","p-2","border","rounded-md","mb-3",3,"input","value"],[1,"flex","justify-end","gap-2"],[1,"px-4","py-2","border","rounded-md",3,"click"],[1,"px-4","py-2","bg-green-500","text-white","rounded-md",3,"click"],["type","text","placeholder","Ejm: Inversi\xf3n CDT",1,"w-full","p-2","border","rounded-md","mb-3",3,"ngModelChange","ngModel"],["type","text","placeholder","Ejm: 1.000.000",1,"w-full","p-2","border","rounded-md","mb-3",3,"input","value"]],template:function(n,r){1&n&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"h6",3),t.EFF(5,"Mis Ahorros"),t.k0s(),t.j41(6,"p",4)(7,"strong"),t.EFF(8,"Estado Actual"),t.k0s()()()(),t.j41(9,"div",5)(10,"table",6)(11,"thead",7)(12,"tr",8)(13,"th",9),t.EFF(14,"Ahorro en"),t.k0s(),t.j41(15,"th",10),t.EFF(16,"Valor"),t.k0s(),t.j41(17,"th",11),t.EFF(18,"Acciones"),t.k0s()()(),t.j41(19,"tbody"),t.DNE(20,E,10,2,"tr",12),t.j41(21,"tr",13)(22,"td",14),t.EFF(23,"Total"),t.k0s(),t.j41(24,"td",15),t.EFF(25),t.k0s(),t.nrm(26,"td"),t.k0s()()()(),t.j41(27,"div",16)(28,"button",17),t.bIt("click",function(){return r.openModal()}),t.EFF(29," Agregar Ahorro + "),t.k0s()(),t.DNE(30,_,15,2,"div",18)(31,j,15,2,"div",18),t.k0s()()),2&n&&(t.R7$(20),t.Y8G("ngForOf",r.savings),t.R7$(5),t.SpI(" $",r.formatCurrency(r.getTotalSavings())," "),t.R7$(5),t.Y8G("ngIf",r.isModalOpen),t.R7$(),t.Y8G("ngIf",r.isEditModalOpen))},dependencies:[l.MD,l.Sq,l.bT,p.YN,p.me,p.BC,p.vS]})}}return o})()}}]);